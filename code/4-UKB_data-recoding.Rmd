# Preparing the UK Biobank exposome datasets

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(results = 'hide')
# knitr::opts_chunk$set(eval =  FALSE)
```

The following sections detail the methods and code used to prepare the UK Biobank datasets for analysis. There is no output shown in any of these sections. Instead, all the code used to clean, recode, manipulate, and subset the datasets are shown here for reproducibility and transparency. If you wish to go straight to the analysis output, then skip this section and start with the missing data and imputation analyses in the [Imputation](#imputation) section or with the [Summary statistics](#summary-statistics) section.    

```{css, echo=FALSE}

# css code to make code chunks appear in scrollable boxes
# 
# pre {
#   max-height: 800px;
#   overflow-y: auto;
# }
# 
# pre[class] {
#   max-height: 800px;
# }
```

## Cleaning and recoding data

This section shows the code used to clean and recode all of the initial ~800 environmental variables in the UK Biobank dataset for my DPhil. Recoding is shown below by category of variables. This section is included to illustrate the extraordinary amount of coding that went into creating the analytic dataset for the environment-wide association study (EWAS) analyses. There is no output shown from this code.

```{r ukb}

# load uncoded dataset with all exposome variables
load(".../UKB/Datasets/4. Categorized raw datasets/ukb_all_exposures_june_22_2023.RData")

library(Hmisc)
library(dplyr)

# turn all "prefer not to answer", "do not know", "not applicable" to NA
# exclude recruitment date b/c it returns error

dat[colnames(dat) != "recruitment_date"][dat[colnames(dat) != "recruitment_date"] == "Prefer not to answer"] <- NA
dat[colnames(dat) != "recruitment_date"][dat[colnames(dat) != "recruitment_date"] == "Do not know"] <- NA
dat[colnames(dat) != "recruitment_date"][dat[colnames(dat) != "recruitment_date"] == "Not applicable"] <- NA

nrow(dat)
nrow(dat[colnames(dat) != "recruitment_date"] == "Prefer not to answer")

```
<br /> 

### Early life factors
```{r elf, results='hide'}

unique(dat$country_birth)
unique(dat$breastfed)
unique(dat$body_size_10yrs_old)
unique(dat$height_10yrs_old)
unique(dat$handedness)
unique(dat$adopted)
unique(dat$part_multiple_birth)
unique(dat$maternal_smoking)
unique(dat$birth_weight)
summary(dat$birth_weight)
str(dat$birth_weight)
unique(dat$birth_weight_known)

# convert to factors / numeric
# make unordered
# set reference category

dat$country_birth <- factor(dat$country_birth, ordered = FALSE)
dat$country_birth <- relevel(dat$country_birth, ref = "England")

dat$breastfed <- factor(dat$breastfed, ordered = FALSE)
dat$breastfed <- relevel(dat$breastfed, ref = "No")

# table(dat$body_size_10yrs_old)
dat$body_size_10yrs_old <- factor(dat$body_size_10yrs_old, ordered = FALSE)
dat$body_size_10yrs_old <- relevel(dat$body_size_10yrs_old, ref = "About average")

# table(dat$height_10yrs_old)
dat$height_10yrs_old <- factor(dat$height_10yrs_old, ordered = FALSE)
dat$height_10yrs_old <- relevel(dat$height_10yrs_old, ref = "About average")

# table(dat$handedness)
dat$handedness <- factor(dat$handedness, ordered = FALSE)
dat$handedness <- relevel(dat$handedness, ref = "Right-handed")

dat$adopted <- factor(dat$adopted, levels = c("No", "Yes"), ordered = FALSE)
dat$adopted <- relevel(dat$adopted, ref = "No")

dat$part_multiple_birth <- factor(dat$part_multiple_birth, ordered = FALSE)
dat$part_multiple_birth <- relevel(dat$part_multiple_birth, ref = "No")

dat$maternal_smoking <- factor(dat$maternal_smoking, ordered = FALSE)
dat$maternal_smoking <- relevel(dat$maternal_smoking, ref = "No")

dat$birth_weight_known <- factor(dat$birth_weight_known, ordered = FALSE)
dat$birth_weight_known <- relevel(dat$birth_weight_known, ref = "No")

```
<br /> 

### Stressful life events
```{r sle, results='hide'}

unique(dat$sle.0.0)

### dummy vars

unique(dat$sle.0.0)

prefix <- "sle.0."
suffix <- seq(0,5)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]

# dummy var for self illness/injury/assault
dat$self_illness_injury_assault <- ifelse(rowSums(dat[f] == "Serious illness, injury or assault to yourself", na.rm = TRUE) > 0, 1, 
                                          ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$self_illness_injury_assault)

dat$self_illness_injury_assault <- recode_factor(dat$self_illness_injury_assault,
                                                 "0" = "No",
                                                 "1" = "Yes")


#create dummy var for self illness/injury/assault of close relative
dat$relative_illness_injury_assault <- ifelse(
  rowSums(dat[f] == "Serious illness, injury or assault of a close relative", na.rm = TRUE) > 0, 1, 
  ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))

table(dat$relative_illness_injury_assault)
dat$relative_illness_injury_assault <- recode_factor(dat$relative_illness_injury_assault,
                                                     "0" = "No",
                                                     "1" = "Yes")


#create dummy var for death of a close relative
dat$death_relative <- ifelse(rowSums(dat[f] == "Death of a close relative", na.rm = TRUE) > 0,
                             1,
                             ifelse(rowSums(is.na(dat[f])) < length(f), 
                                    0, 
                                    NA))

table(dat$death_relative)
dat$death_relative <- recode_factor(dat$death_relative,
                                    "0" = "No",
                                    "1" = "Yes")


#create dummy var for death of a partner
dat$death_partner <- ifelse(rowSums(dat[f] == "Death of a spouse or partner", na.rm = TRUE) > 0, 1, 
                            ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$death_partner)
dat$death_partner <- recode_factor(dat$death_partner,
                                   "0" = "No",
                                   "1" = "Yes")


#create dummy var for divorce
dat$divorce <- ifelse(rowSums(dat[f] == "Marital separation/divorce", na.rm = TRUE) > 0, 1, 
                      ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$divorce)
dat$divorce <- recode_factor(dat$divorce,
                             "0" = "No",
                             "1" = "Yes")


#create dummy var for Financial difficulties
dat$financial_difficulty <- ifelse(rowSums(dat[f] == "Financial difficulties", na.rm = TRUE) > 0, 1, 
                                   ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$financial_difficulty)
dat$financial_difficulty <- recode_factor(dat$financial_difficulty,
                                          "0" = "No",
                                          "1" = "Yes")


#subset df to only include new dummy variables
dat <- subset(dat, select = -c(sle.0.0,
                               sle.0.1,
                               sle.0.2,
                               sle.0.3,
                               sle.0.4,
                               sle.0.5))

```
<br /> 

### Social factors
```{r social, results='hide'}

unique(dat$family_visit_freq)
unique(dat$confide_freq)
unique(dat$loneliness)

# convert to factors / numeric
# make unordered
# set reference category

dat$family_visit_freq <- factor(dat$family_visit_freq, ordered = FALSE)
dat$family_visit_freq <- relevel(dat$family_visit_freq, ref = "No friends/family outside household")                         

dat$confide_freq <- factor(dat$confide_freq, ordered = FALSE)
dat$confide_freq <- relevel(dat$confide_freq, ref = "Never or almost never")                             

dat$loneliness <- factor(dat$loneliness, ordered = FALSE)
dat$loneliness <- relevel(dat$loneliness, ref = "No")                             


### dummy variables

unique(dat$social_activity.0.0)

prefix <- "social_activity.0."
suffix <- seq(0,4)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]


# create dummy var for sports club / gym
dat$gym <- ifelse(rowSums(dat[f] == "Sports club or gym", na.rm = TRUE) > 0, 1, 
                  ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$gym)
dat$gym <- recode_factor(dat$gym,
                         "0" = "No",
                         "1" = "Yes")


#create dummy var for pub or social group
dat$pub <- ifelse(rowSums(dat[f] == "Pub or social club", na.rm = TRUE) > 0, 1, 
                  ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$pub)
dat$pub <- recode_factor(dat$pub,
                         "0" = "No",
                         "1" = "Yes")


#create dummy var for religious group
dat$religious_group <- ifelse(rowSums(dat[f] == "Religious group", na.rm = TRUE) > 0, 1, 
                              ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$religious_group)
dat$religious_group <- recode_factor(dat$religious_group,
                                     "0" = "No",
                                     "1" = "Yes")


#create dummy var for adult education class
dat$adult_education <- ifelse(rowSums(dat[f] == "Adult education class", na.rm = TRUE) > 0, 1, 
                              ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adult_education)
dat$adult_education <- recode_factor(dat$adult_education,
                                     "0" = "No",
                                     "1" = "Yes")


#create dummy var for Other group activity
dat$other_group_activity <- ifelse(rowSums(dat[f] == "Other group activity", na.rm = TRUE) > 0, 1, 
                                   ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$other_group_activity)
dat$other_group_activity <- recode_factor(dat$other_group_activity,
                                          "0" = "No",
                                          "1" = "Yes")

#remove columns used to make dummy vars
dat <- subset(dat, select = -c(social_activity.0.0,
                               social_activity.0.1,
                               social_activity.0.2,
                               social_activity.0.3,
                               social_activity.0.4)) 

```
<br /> 

### Sociodemographics
```{r socio_dem, results='hide'}

unique(dat$accommodation_type)
unique(dat$own_or_rent)
unique(dat$gas_fuel_heat.0.0)
unique(dat$years_at_address)
unique(dat$hshld_number)
unique(dat$hshld_relations.0.0)
unique(dat$hshld_vehicles)
unique(dat$hshld_income)
unique(dat$education_years.0.0)
unique(dat$employment_corrected)
unique(dat$employment_distance)
unique(dat$employment.0.0)
unique(dat$employment_years)
unique(dat$employment_hours)
unique(dat$employment_travel_freq)
unique(dat$commute_transport.0.0)
unique(dat$employment_standing)
unique(dat$employment_heavy_manual)
unique(dat$shift_work)
unique(dat$night_shift_work)
unique(dat$noisy_workplace)
unique(dat$immigration_year)
unique(dat$ethnicity)
unique(dat$public_assistance.0.0)
unique(dat$private_healthcare)
unique(dat$recruitment_age)
unique(dat$birth_year)
unique(dat$sex)
unique(dat$recruitment_centre)
str(dat$recruitment_centre)
str(dat$recruitment_date)

# convert to factors / numeric
# make unordered
# set reference category

# table(dat$accommodation_type) # check to see most frequent level
dat$accommodation_type <- factor(dat$accommodation_type, ordered = FALSE)
dat$accommodation_type <- relevel(dat$accommodation_type, ref = "A house or bungalow")

# table(dat$own_or_rent) # check to see most frequent level
dat$own_or_rent <- factor(dat$own_or_rent, ordered = FALSE)
dat$own_or_rent <- relevel(dat$own_or_rent, ref = "Own outright (by you or someone in your household)")

dat$years_at_address <- as.numeric(dat$years_at_address)
dat$years_at_address[which(dat$years_at_address == "-10")] <- 0.5
dat$years_at_address[which(dat$years_at_address == "-3")] <- NA
dat$years_at_address[which(dat$years_at_address == "-1")] <- NA

dat$hshld_number <- as.numeric(dat$hshld_number)
dat$hshld_number[which(dat$hshld_number == "-3")] <- NA
dat$hshld_number[which(dat$hshld_number == "-1")] <- NA

dat$hshld_vehicles <- factor(dat$hshld_vehicles, ordered = FALSE)
dat$hshld_vehicles <- relevel(dat$hshld_vehicles, ref = "None")

dat$hshld_income <- factor(dat$hshld_income, ordered = FALSE)
dat$hshld_income <- relevel(dat$hshld_income, ref = "Less than 18,000")

dat$education_age_complete <- as.numeric(dat$education_age_complete)
dat$education_age_complete[which(dat$education_age_complete == "-3")] <- NA
dat$education_age_complete[which(dat$education_age_complete == "-2")] <- NA
dat$education_age_complete[which(dat$education_age_complete == "-1")] <- NA

# table(dat$employment_corrected) # check to see most frequent level
dat$employment_corrected <- factor(dat$employment_corrected, ordered = FALSE)
dat$employment_corrected <- relevel(dat$employment_corrected, ref = "Retired")

dat$employment_distance <- as.numeric(dat$employment_distance)
dat$employment_distance[which(dat$employment_distance == "-10")] <- 0.5
dat$employment_distance[which(dat$employment_distance == "-3")] <- NA
dat$employment_distance[which(dat$employment_distance == "-1")] <- NA

dat$employment_years <- as.numeric(dat$employment_years)
dat$employment_years[which(dat$employment_years == "-10")] <- 0.5
dat$employment_years[which(dat$employment_years == "-3")] <- NA
dat$employment_years[which(dat$employment_years == "-1")] <- NA

dat$employment_hours <- as.numeric(dat$employment_hours)
dat$employment_hours[which(dat$employment_hours == "-3")] <- NA
dat$employment_hours[which(dat$employment_hours == "-1")] <- NA

dat$employment_travel_freq <- as.numeric(dat$employment_travel_freq)
dat$employment_travel_freq[which(dat$employment_travel_freq == "-10")] <- 0.5
dat$employment_travel_freq[which(dat$employment_travel_freq == "-3")] <- NA
dat$employment_travel_freq[which(dat$employment_travel_freq == "-1")] <- NA

dat$employment_standing <- factor(dat$employment_standing, ordered = FALSE)
dat$employment_standing <- relevel(dat$employment_standing, ref = "Never/rarely")

dat$employment_heavy_manual <- factor(dat$employment_heavy_manual, ordered = FALSE)
dat$employment_heavy_manual <- relevel(dat$employment_heavy_manual, ref = "Never/rarely")

dat$shift_work <- factor(dat$shift_work, ordered = FALSE)
dat$shift_work <- relevel(dat$shift_work, ref = "Never/rarely")

dat$night_shift_work <- factor(dat$night_shift_work, ordered = FALSE)
dat$night_shift_work <- relevel(dat$night_shift_work, ref = "Never/rarely")

dat$noisy_workplace <- factor(dat$noisy_workplace, ordered = FALSE)
dat$noisy_workplace <- relevel(dat$noisy_workplace, ref = "No")

dat$immigration_year <- as.numeric(dat$immigration_year)
dat$immigration_year[which(dat$immigration_year == "-3")] <- NA
dat$immigration_year[which(dat$immigration_year == "-1")] <- NA

table(dat$ethnicity) # check to see most frequent level
dat$ethnicity <- factor(dat$ethnicity, ordered = FALSE)
dat$ethnicity <- relevel(dat$ethnicity, ref = "British")

dat$private_healthcare <- factor(dat$private_healthcare, ordered = FALSE)
dat$private_healthcare <- relevel(dat$private_healthcare, ref = "No, never")

dat$recruitment_age <- as.numeric(dat$recruitment_age)

dat$birth_year <- as.numeric(dat$birth_year)

table(dat$sex) # check to see most frequent level
dat$sex <- factor(dat$sex, ordered = FALSE)
dat$sex <- relevel(dat$sex, ref = "Female")

dat$recruitment_centre <- as.factor(dat$recruitment_centre)
dat$recruitment_centre <- relevel(dat$recruitment_centre, ref = "11010")


### dummy variables

## gas fuel heat

unique(dat$gas_fuel_heat.0.0)

prefix <- "gas_fuel_heat.0."
suffix <- seq(0,2)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]


# create dummy var for A gas hob or gas cooker
dat$gas_hob_heat <- ifelse(rowSums(dat[f] == "A gas hob or gas cooker", na.rm = TRUE) > 0, 1, 
                           ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$gas_hob_heat)
dat$gas_hob_heat <- recode_factor(dat$gas_hob_heat,
                                  "0" = "No",
                                  "1" = "Yes")

# create dummy var for A gas fire that you use regularly in winter time
dat$gas_fire_heat <- ifelse(rowSums(dat[f] == "A gas fire that you use regularly in winter time", na.rm = TRUE) > 0, 1, 
                            ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$gas_fire_heat)
dat$gas_fire_heat <- recode_factor(dat$gas_fire_heat,
                                   "0" = "No",
                                   "1" = "Yes")

# create dummy var for An open solid fuel fire that you use regularly in winter time
dat$open_fire_heat <- ifelse(rowSums(dat[f] == "An open solid fuel fire that you use regularly in winter time", na.rm = TRUE) > 0, 1, 
                             ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$open_fire_heat)
dat$open_fire_heat <- recode_factor(dat$open_fire_heat,
                                    "0" = "No",
                                    "1" = "Yes")


## heating type

unique(dat$heating_type.0.0,)

prefix <- "heating_type.0."
suffix <- seq(0,2)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]


# create dummy var for Gas central heating
dat$gas_central_heat <- ifelse(rowSums(dat[f] == "Gas central heating", na.rm = TRUE) > 0, 1, 
                               ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$gas_central_heat)
dat$gas_central_heat <- recode_factor(dat$gas_central_heat,
                                      "0" = "No",
                                      "1" = "Yes")

# create dummy var for Electric storage heaters
dat$electric_storage_heat <- ifelse(rowSums(dat[f] == "Electric storage heaters", na.rm = TRUE) > 0, 1, 
                                    ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$electric_storage_heat)
dat$electric_storage_heat <- recode_factor(dat$electric_storage_heat,
                                           "0" = "No",
                                           "1" = "Yes")

# create dummy var for Oil (kerosene) central heating
dat$oil_central_heat <- ifelse(rowSums(dat[f] == "Oil (kerosene) central heating", na.rm = TRUE) > 0, 1, 
                               ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$oil_central_heat)
dat$oil_central_heat <- recode_factor(dat$oil_central_heat,
                                      "0" = "No",
                                      "1" = "Yes")

# create dummy var for Portable gas or paraffin heaters
dat$portable_gas_heat <- ifelse(rowSums(dat[f] == "Portable gas or paraffin heaters", na.rm = TRUE) > 0, 1, 
                                ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$portable_gas_heat)
dat$portable_gas_heat <- recode_factor(dat$portable_gas_heat,
                                       "0" = "No",
                                       "1" = "Yes")

# create dummy var for Solid fuel central heating
dat$solid_fuel_heat <- ifelse(rowSums(dat[f] == "Solid fuel central heating", na.rm = TRUE) > 0, 1, 
                              ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$solid_fuel_heat)
dat$solid_fuel_heat <- recode_factor(dat$solid_fuel_heat,
                                     "0" = "No",
                                     "1" = "Yes")

# create dummy var for Open fire without central heating
dat$open_fire_no_central_heat <- ifelse(rowSums(dat[f] == "Open fire without central heating", na.rm = TRUE) > 0, 1, 
                                        ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$open_fire_no_central_heat)
dat$open_fire_no_central_heat <- recode_factor(dat$open_fire_no_central_heat,
                                               "0" = "No",
                                               "1" = "Yes")


## household relations

unique(dat$hshld_relations.0.0)

prefix <- "hshld_relations.0."
suffix <- seq(0,4)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]


# create dummy var for Husband, wife or partner
dat$hshld_partner <- ifelse(rowSums(dat[f] == "Husband, wife or partner", na.rm = TRUE) > 0, 1, 
                            ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$hshld_partner)
dat$hshld_partner <- recode_factor(dat$hshld_partner,
                                   "0" = "No",
                                   "1" = "Yes")

# create dummy var for Son and/or daughter (include step-children)
dat$hshld_children <- ifelse(rowSums(dat[f] == "Son and/or daughter (include step-children)", na.rm = TRUE) > 0, 1, 
                             ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$hshld_children)
dat$hshld_children <- recode_factor(dat$hshld_children,
                                    "0" = "No",
                                    "1" = "Yes")

# create dummy var for Brother and/or sister
dat$hshld_siblings <- ifelse(rowSums(dat[f] == "Brother and/or sister", na.rm = TRUE) > 0, 1, 
                             ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$hshld_siblings)
dat$hshld_siblings <- recode_factor(dat$hshld_siblings,
                                    "0" = "No",
                                    "1" = "Yes")

# create dummy var for Mother and/or father
dat$hshld_parents <- ifelse(rowSums(dat[f] == "Mother and/or father", na.rm = TRUE) > 0, 1, 
                            ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$hshld_parents)
dat$hshld_parents <- recode_factor(dat$hshld_parents,
                                   "0" = "No",
                                   "1" = "Yes")

# create dummy var for Grandparent
dat$hshld_grandparent <- ifelse(rowSums(dat[f] == "Grandparent", na.rm = TRUE) > 0, 1, 
                                ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$hshld_grandparent)
dat$hshld_grandparent <- recode_factor(dat$hshld_grandparent,
                                       "0" = "No",
                                       "1" = "Yes")

# create dummy var for Grandchild
dat$hshld_grandchild <- ifelse(rowSums(dat[f] == "Grandchild", na.rm = TRUE) > 0, 1, 
                               ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$hshld_grandchild)
dat$hshld_grandchild <- recode_factor(dat$hshld_grandchild,
                                      "0" = "No",
                                      "1" = "Yes")

# create dummy var for Other related
dat$hshld_other_related <- ifelse(rowSums(dat[f] == "Other related", na.rm = TRUE) > 0, 1, 
                                  ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$hshld_other_related)
dat$hshld_other_related <- recode_factor(dat$hshld_other_related,
                                         "0" = "No",
                                         "1" = "Yes")

# create dummy var for Other unrelated
dat$hshld_other_unrelated <- ifelse(rowSums(dat[f] == "Other unrelated", na.rm = TRUE) > 0, 1, 
                                    ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$hshld_other_unrelated)
dat$hshld_other_unrelated <- recode_factor(dat$hshld_other_unrelated,
                                           "0" = "No",
                                           "1" = "Yes")


## education qualifications

unique(dat$education_years.0.0)

prefix <- "education_years.0."
suffix <- seq(0,5)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]


# create dummy var for College or University degree
dat$education_college <- ifelse(rowSums(dat[f] == "College or University degree", na.rm = TRUE) > 0, 1, 
                                ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$education_college) # check your work
dat$education_college <- recode_factor(dat$education_college,
                                       "0" = "No",
                                       "1" = "Yes")

# create dummy var for A levels/AS levels or equivalent
dat$education_A_levels <- ifelse(rowSums(dat[f] == "A levels/AS levels or equivalent", na.rm = TRUE) > 0, 1, 
                                 ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$education_A_levels) # check your work
dat$education_A_levels <- recode_factor(dat$education_A_levels,
                                        "0" = "No",
                                        "1" = "Yes")

# create dummy var for O levels/GCSEs or equivalent
dat$education_O_levels <- ifelse(rowSums(dat[f] == "O levels/GCSEs or equivalent", na.rm = TRUE) > 0, 1, 
                                 ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$education_O_levels)
dat$education_O_levels <- recode_factor(dat$education_O_levels,
                                        "0" = "No",
                                        "1" = "Yes")

# create dummy var for CSEs or equivalent
dat$education_CSEs <- ifelse(rowSums(dat[f] == "CSEs or equivalent", na.rm = TRUE) > 0, 1, 
                             ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$education_CSEs)
dat$education_CSEs <- recode_factor(dat$education_CSEs,
                                    "0" = "No",
                                    "1" = "Yes")

# create dummy var for NVQ or HND or HNC or equivalent
dat$education_NVQ <- ifelse(rowSums(dat[f] == "NVQ or HND or HNC or equivalent", na.rm = TRUE) > 0, 1, 
                            ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$education_NVQ) # check your work
dat$education_NVQ <- recode_factor(dat$education_NVQ,
                                   "0" = "No",
                                   "1" = "Yes")

# create dummy var for Other professional qualifications eg: nursing, teaching
dat$education_other_professional <- ifelse(rowSums(dat[f] == "Other professional qualifications eg: nursing, teaching", na.rm = TRUE) > 0, 1, 
                                           ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$education_other_professional) # check your work
dat$education_other_professional <- recode_factor(dat$education_other_professional,
                                                  "0" = "No",
                                                  "1" = "Yes")

# create dummy var for None of the above
dat$education_none <- ifelse(rowSums(dat[f] == "None of the above", na.rm = TRUE) > 0, 1, 
                                           ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$education_none) # check your work
dat$education_none <- recode_factor(dat$education_none,
                                    "0" = "No",
                                    "1" = "Yes")


## employment

unique(dat$employment.0.0)

prefix <- "employment.0."
suffix <- seq(0,6)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]


# create dummy var for In paid employment or self-employed
dat$employed <- ifelse(rowSums(dat[f] == "In paid employment or self-employed", na.rm = TRUE) > 0, 1, 
                       ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$employed)
dat$employed <- recode_factor(dat$employed,
                              "0" = "No",
                              "1" = "Yes")

# create dummy var for Retired
dat$retired <- ifelse(rowSums(dat[f] == "Retired", na.rm = TRUE) > 0, 1, 
                      ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$retired)
dat$retired <- recode_factor(dat$retired,
                             "0" = "No",
                             "1" = "Yes")

# create dummy var for Looking after home and/or family
dat$home_maker <- ifelse(rowSums(dat[f] == "Looking after home and/or family", na.rm = TRUE) > 0, 1, 
                         ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$home_maker)
dat$home_maker <- recode_factor(dat$home_maker,
                                "0" = "No",
                                "1" = "Yes")

# create dummy var for Unable to work because of sickness or disability
dat$unemployed_disability <- ifelse(rowSums(dat[f] == "Unable to work because of sickness or disability", na.rm = TRUE) > 0, 1, 
                                    ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$unemployed_disability)
dat$unemployed_disability <- recode_factor(dat$unemployed_disability,
                                           "0" = "No",
                                           "1" = "Yes")

# create dummy var for Unemployed
dat$unemployed <- ifelse(rowSums(dat[f] == "Unemployed", na.rm = TRUE) > 0, 1, 
                         ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$unemployed)
dat$unemployed <- recode_factor(dat$unemployed,
                                "0" = "No",
                                "1" = "Yes")

# create dummy var for Doing unpaid or voluntary work
dat$volunteer <- ifelse(rowSums(dat[f] == "Doing unpaid or voluntary work", na.rm = TRUE) > 0, 1, 
                        ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$volunteer)
dat$volunteer <- recode_factor(dat$volunteer,
                               "0" = "No",
                               "1" = "Yes")

# create dummy var for Full or part-time student
dat$student <- ifelse(rowSums(dat[f] == "Full or part-time student", na.rm = TRUE) > 0, 1, 
                      ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$student)
dat$student <- recode_factor(dat$student,
                             "0" = "No",
                             "1" = "Yes")


## transport type

unique(dat$commute_transport.0.0)

prefix <- "commute_transport.0."
suffix <- seq(0,3)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]


# create dummy var for Car/motor vehicle
dat$car_commute <- ifelse(rowSums(dat[f] == "Car/motor vehicle", na.rm = TRUE) > 0, 1, 
                          ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$car_commute)
dat$car_commute <- recode_factor(dat$car_commute,
                                 "0" = "No",
                                 "1" = "Yes")

# create dummy var for Walk
dat$walk_commute <- ifelse(rowSums(dat[f] == "Walk", na.rm = TRUE) > 0, 1, 
                           ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$walk_commute)
dat$walk_commute <- recode_factor(dat$walk_commute,
                                  "0" = "No",
                                  "1" = "Yes")

# create dummy var for Public transport
dat$public_transport_commute <- ifelse(rowSums(dat[f] == "Public transport", na.rm = TRUE) > 0, 1, 
                                       ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$public_transport_commute)
dat$public_transport_commute <- recode_factor(dat$public_transport_commute,
                                              "0" = "No",
                                              "1" = "Yes")

# create dummy var for Cycle
dat$cycle_commute <- ifelse(rowSums(dat[f] == "Cycle", na.rm = TRUE) > 0, 1, 
                            ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$cycle_commute)
dat$cycle_commute <- recode_factor(dat$cycle_commute,
                                   "0" = "No",
                                   "1" = "Yes")


## public assistance

unique(dat$public_assistance.0.0)

prefix <- "public_assistance.0."
suffix <- seq(0,2)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]


# create dummy var for Attendance allowance
dat$attendance_allowance <- ifelse(rowSums(dat[f] == "Attendance allowance", na.rm = TRUE) > 0, 1, 
                                   ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$attendance_allowance)
dat$attendance_allowance <- recode_factor(dat$attendance_allowance,
                                          "0" = "No",
                                          "1" = "Yes")

# create dummy var for Disability living allowance
dat$disability_allowance <- ifelse(rowSums(dat[f] == "Disability living allowance", na.rm = TRUE) > 0, 1, 
                                   ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$disability_allowance)
dat$disability_allowance <- recode_factor(dat$disability_allowance,
                                          "0" = "No",
                                          "1" = "Yes")

# create dummy var for Blue badge
dat$blue_badge <- ifelse(rowSums(dat[f] == "Blue badge", na.rm = TRUE) > 0, 1, 
                         ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$blue_badge)
dat$blue_badge <- recode_factor(dat$blue_badge,
                                "0" = "No",
                                "1" = "Yes")


#remove columns used to make dummy vars
dat <- subset(dat, select = -c(gas_fuel_heat.0.0, 
                               gas_fuel_heat.0.1,
                               gas_fuel_heat.0.2,
                               heating_type.0.0,
                               heating_type.0.1,
                               heating_type.0.2,
                               hshld_relations.0.0,
                               hshld_relations.0.1,
                               hshld_relations.0.2,
                               hshld_relations.0.3,
                               hshld_relations.0.4,
                               education_years.0.0,
                               education_years.0.1,
                               education_years.0.2,
                               education_years.0.3,
                               education_years.0.4,
                               education_years.0.5,
                               employment.0.0,
                               employment.0.1,
                               employment.0.2,
                               employment.0.3,
                               employment.0.4,
                               employment.0.5,
                               employment.0.6,
                               commute_transport.0.0,
                               commute_transport.0.1,
                               commute_transport.0.2,
                               commute_transport.0.3,
                               public_assistance.0.0,
                               public_assistance.0.1,
                               public_assistance.0.2))

```
<br /> 

### Family health history
```{r fam_health, results='hide'}

unique(dat$death_close_family)
unique(dat$father_alive)
unique(dat$adopted_father_alive)
unique(dat$father_age)
unique(dat$father_age_death)
unique(dat$mother_alive)
unique(dat$adopted_mother_alive)
unique(dat$mother_age)
unique(dat$mother_age_death)
unique(dat$number_brothers)
unique(dat$number_adopted_brothers)
unique(dat$number_sisters)
unique(dat$number_adopted_sisters)
unique(dat$number_older_siblings)


# convert to factors / numeric
# make unordered
# set reference category

dat$death_close_family <- factor(dat$death_close_family, ordered = FALSE)
dat$death_close_family <- relevel(dat$death_close_family, ref = "No")

dat$father_alive <- factor(dat$father_alive, ordered = FALSE)
dat$father_alive <- relevel(dat$father_alive, ref = "No")

dat$adopted_father_alive <- factor(dat$adopted_father_alive, ordered = FALSE)
dat$adopted_father_alive <- relevel(dat$adopted_father_alive, ref = "No")

dat$father_age <- as.numeric(dat$father_age)
dat$father_age[which(dat$father_age == "-3")] <- NA
dat$father_age[which(dat$father_age == "-1")] <- NA

dat$father_age_death <- as.numeric(dat$father_age_death)
dat$father_age_death[which(dat$father_age_death == "-3")] <- NA
dat$father_age_death[which(dat$father_age_death == "-1")] <- NA

dat$mother_alive <- factor(dat$mother_alive,  ordered = FALSE)
dat$mother_alive <- relevel(dat$mother_alive, ref = "No")

dat$adopted_mother_alive <- factor(dat$adopted_mother_alive, ordered = FALSE)
dat$adopted_mother_alive <- relevel(dat$adopted_mother_alive, ref = "No")

dat$mother_age <- as.numeric(dat$mother_age)
dat$mother_age[which(dat$mother_age == "-3")] <- NA
dat$mother_age[which(dat$mother_age == "-1")] <- NA

dat$mother_age_death <- as.numeric(dat$mother_age_death)
dat$mother_age_death[which(dat$mother_age_death == "-3")] <- NA
dat$mother_age_death[which(dat$mother_age_death == "-1")] <- NA

dat$number_brothers <- as.numeric(dat$number_brothers)
dat$number_brothers[which(dat$number_brothers == "-3")] <- NA
dat$number_brothers[which(dat$number_brothers == "-1")] <- NA

dat$number_adopted_brothers <- as.numeric(dat$number_adopted_brothers)
dat$number_adopted_brothers[which(dat$number_adopted_brothers == "-3")] <- NA
dat$number_adopted_brothers[which(dat$number_adopted_brothers == "-1")] <- NA

dat$number_sisters <- as.numeric(dat$number_sisters)
dat$number_sisters[which(dat$number_sisters == "-3")] <- NA
dat$number_sisters[which(dat$number_sisters == "-1")] <- NA

dat$number_adopted_sisters <- as.numeric(dat$number_adopted_sisters)
dat$number_adopted_sisters[which(dat$number_adopted_sisters == "-3")] <- NA
dat$number_adopted_sisters[which(dat$number_adopted_sisters == "-1")] <- NA

dat$number_older_siblings <- as.numeric(dat$number_older_siblings)
dat$number_older_siblings[which(dat$number_older_siblings == "-3")] <- NA
dat$number_older_siblings[which(dat$number_older_siblings == "-1")] <- NA


### dummy variables

# get column numbers of family illness vars
fam_first <- match("adopted_father_illness.0.0", names(dat)) # col #
fam_last <- match("sibling_illness.0.11", names(dat)) # col #

dat[fam_first:fam_last][dat[fam_first:fam_last] == "Do not know (group 1)"] <- NA 
dat[fam_first:fam_last][dat[fam_first:fam_last] == "Prefer not to answer (group 1)"] <- NA 
dat[fam_first:fam_last][dat[fam_first:fam_last] == "Do not know (group 2)"] <- NA 
dat[fam_first:fam_last][dat[fam_first:fam_last] == "Prefer not to answer (group 2)"] <- NA 

unique(dat$adopted_father_illness.0.0)

## mother illness history

prefix <- "mother_illness.0."
suffix <- seq(0,10)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]

# dummy var for alzheimer's history
dat$mother_alzheimers <- ifelse(rowSums(dat[f] == "Alzheimer's disease/dementia", na.rm = TRUE) > 0, 1, 
                                ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$mother_alzheimers)
dat$mother_alzheimers <- recode_factor(dat$mother_alzheimers,
                                       "0" = "No",
                                       "1" = "Yes")

# dummy var for severe depression history
dat$mother_severe_depression <- ifelse(rowSums(dat[f] == "Severe depression", na.rm = TRUE) > 0, 1, 
                                       ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$mother_severe_depression)
dat$mother_severe_depression <- recode_factor(dat$mother_severe_depression,
                                              "0" = "No",
                                              "1" = "Yes")

# dummy var for parkinsons history
dat$mother_parkinsons <- ifelse(rowSums(dat[f] == "Parkinson's disease", na.rm = TRUE) > 0, 1,
                                ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$mother_parkinsons)
dat$mother_parkinsons <- recode_factor(dat$mother_parkinsons,
                                       "0" = "No",
                                       "1" = "Yes")

# dummy var for diabetes history
dat$mother_diabetes <- ifelse(rowSums(dat[f] == "Diabetes", na.rm = TRUE) > 0, 1, 
                              ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$mother_diabetes)
dat$mother_diabetes <- recode_factor(dat$mother_diabetes,
                                     "0" = "No",
                                     "1" = "Yes")

# dummy var for high bloood pressure history
dat$mother_high_blood_pressure <- ifelse(rowSums(dat[f] == "High blood pressure", na.rm = TRUE) > 0, 1, 
                                         ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$mother_high_blood_pressure)
dat$mother_high_blood_pressure <- recode_factor(dat$mother_high_blood_pressure,
                                                "0" = "No",
                                                "1" = "Yes")

# dummy var for chronic bronchitis/emphysema history
dat$mother_bronchitis_emphysema <- ifelse(rowSums(dat[f] == "Chronic bronchitis/emphysema", na.rm = TRUE) > 0, 1, 
                                          ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$mother_bronchitis_emphysema)
dat$mother_bronchitis_emphysema <- recode_factor(dat$mother_bronchitis_emphysema,
                                                 "0" = "No",
                                                 "1" = "Yes")

# dummy var for breast cancer history
dat$mother_breast_cancer <- ifelse(rowSums(dat[f] == "Breast cancer", na.rm = TRUE) > 0, 1, 
                                   ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$mother_breast_cancer)
dat$mother_breast_cancer <- recode_factor(dat$mother_breast_cancer,
                                          "0" = "No",
                                          "1" = "Yes")

# dummy var for bowelcancer history
dat$mother_bowel_cancer <- ifelse(rowSums(dat[f] == "Bowel cancer", na.rm = TRUE) > 0, 1, 
                                  ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$mother_bowel_cancer)
dat$mother_bowel_cancer <- recode_factor(dat$mother_bowel_cancer,
                                         "0" = "No",
                                         "1" = "Yes")

# dummy var for lung cancer history
dat$mother_lung_cancer <- ifelse(rowSums(dat[f] == "Lung cancer", na.rm = TRUE) > 0, 1, 
                                 ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$mother_lung_cancer)
dat$mother_lung_cancer <- recode_factor(dat$mother_lung_cancer,
                                        "0" = "No",
                                        "1" = "Yes")

# dummy var for stroke history
dat$mother_stroke <- ifelse(rowSums(dat[f] == "Stroke", na.rm = TRUE) > 0, 1, 
                            ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$mother_stroke)
dat$mother_stroke <- recode_factor(dat$mother_stroke,
                                   "0" = "No",
                                   "1" = "Yes")

# dummy var for heart disease history
dat$mother_heart_disease <- ifelse(rowSums(dat[f] == "Heart disease", na.rm = TRUE) > 0, 1, 
                                   ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$mother_heart_disease)
dat$mother_heart_disease <- recode_factor(dat$mother_heart_disease,
                                          "0" = "No",
                                          "1" = "Yes")

## adopted mother illness history

prefix <- "adopted_mother_illness.0."
suffix <- seq(0,5)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]

# dummy var for alzheimer's history
dat$adopted_mother_alzheimers <- ifelse(rowSums(dat[f] == "Alzheimer's disease/dementia", na.rm = TRUE) > 0, 1, 
                                        ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_mother_alzheimers)
dat$adopted_mother_alzheimers <- recode_factor(dat$adopted_mother_alzheimers,
                                               "0" = "No",
                                               "1" = "Yes")

# dummy var for severe depression history
dat$adopted_mother_severe_depression <- ifelse(rowSums(dat[f] == "Severe depression", na.rm = TRUE) > 0, 1, 
                                               ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_mother_severe_depression)
dat$adopted_mother_severe_depression <- recode_factor(dat$adopted_mother_severe_depression,
                                                      "0" = "No",
                                                      "1" = "Yes")

# dummy var for parkinsons history
dat$adopted_mother_parkinsons <- ifelse(rowSums(dat[f] == "Parkinson's disease", na.rm = TRUE) > 0, 1,
                                        ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_mother_parkinsons)
dat$adopted_mother_parkinsons <- recode_factor(dat$adopted_mother_parkinsons,
                                               "0" = "No",
                                               "1" = "Yes")

# dummy var for diabetes history
dat$adopted_mother_diabetes <- ifelse(rowSums(dat[f] == "Diabetes", na.rm = TRUE) > 0, 1, 
                                      ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_mother_diabetes)
dat$adopted_mother_diabetes <- recode_factor(dat$adopted_mother_diabetes,
                                             "0" = "No",
                                             "1" = "Yes")

# dummy var for high blodd pressure history
dat$adopted_mother_high_blood_pressure <- ifelse(rowSums(dat[f] == "High blood pressure", na.rm = TRUE) > 0, 1, 
                                                 ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_mother_high_blood_pressure)
dat$adopted_mother_high_blood_pressure <- recode_factor(dat$adopted_mother_high_blood_pressure,
                                                        "0" = "No",
                                                        "1" = "Yes")

# dummy var for chronic bronchitis/emphysema history
dat$adopted_mother_bronchitis_emphysema <- ifelse(rowSums(dat[f] == "Chronic bronchitis/emphysema", na.rm = TRUE) > 0, 1, 
                                                  ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_mother_bronchitis_emphysema)
dat$adopted_mother_bronchitis_emphysema <- recode_factor(dat$adopted_mother_bronchitis_emphysema,
                                                         "0" = "No",
                                                         "1" = "Yes")

# dummy var for breast cancer history
dat$adopted_mother_breast_cancer <- ifelse(rowSums(dat[f] == "Breast cancer", na.rm = TRUE) > 0, 1, 
                                           ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_mother_breast_cancer)
dat$adopted_mother_breast_cancer <- recode_factor(dat$adopted_mother_breast_cancer,
                                                  "0" = "No",
                                                  "1" = "Yes")

# dummy var for bowel cancer history
dat$adopted_mother_bowel_cancer <- ifelse(rowSums(dat[f] == "Bowel cancer", na.rm = TRUE) > 0, 1, 
                                          ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_mother_bowel_cancer)
dat$adopted_mother_bowel_cancer <- recode_factor(dat$adopted_mother_bowel_cancer,
                                                 "0" = "No",
                                                 "1" = "Yes")

# dummy var for lung cancer history
dat$adopted_mother_lung_cancer <- ifelse(rowSums(dat[f] == "Lung cancer", na.rm = TRUE) > 0, 1, 
                                         ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_mother_lung_cancer)
dat$adopted_mother_lung_cancer <- recode_factor(dat$adopted_mother_lung_cancer,
                                                "0" = "No",
                                                "1" = "Yes")

# dummy var for stroke history
dat$adopted_mother_stroke <- ifelse(rowSums(dat[f] == "Stroke", na.rm = TRUE) > 0, 1, 
                                    ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_mother_stroke)
dat$adopted_mother_stroke <- recode_factor(dat$adopted_mother_stroke,
                                           "0" = "No",
                                           "1" = "Yes")

# dummy var for heart disease history
dat$adopted_mother_heart_disease <- ifelse(rowSums(dat[f] == "Heart disease", na.rm = TRUE) > 0, 1, 
                                           ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_mother_heart_disease)
dat$adopted_mother_heart_disease <- recode_factor(dat$adopted_mother_heart_disease,
                                                  "0" = "No",
                                                  "1" = "Yes")

## father illness history

prefix <- "father_illness.0."
suffix <- seq(0,9)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]

# dummy var for alzheimer's history
dat$father_alzheimers <- ifelse(rowSums(dat[f] == "Alzheimer's disease/dementia", na.rm = TRUE) > 0, 1, 
                                ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$father_alzheimers)
dat$father_alzheimers <- recode_factor(dat$father_alzheimers,
                                       "0" = "No",
                                       "1" = "Yes")

# dummy var for severe depression history
dat$father_severe_depression <- ifelse(rowSums(dat[f] == "Severe depression", na.rm = TRUE) > 0, 1, 
                                       ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$father_severe_depression)
dat$father_severe_depression <- recode_factor(dat$father_severe_depression,
                                              "0" = "No",
                                              "1" = "Yes")

# dummy var for parkinsons history
dat$father_parkinsons <- ifelse(rowSums(dat[f] == "Parkinson's disease", na.rm = TRUE) > 0, 1,
                                ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$father_parkinsons)
dat$father_parkinsons <- recode_factor(dat$father_parkinsons,
                                       "0" = "No",
                                       "1" = "Yes")

# dummy var for diabetes history
dat$father_diabetes <- ifelse(rowSums(dat[f] == "Diabetes", na.rm = TRUE) > 0, 1, 
                              ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$father_diabetes)
dat$father_diabetes <- recode_factor(dat$father_diabetes,
                                     "0" = "No",
                                     "1" = "Yes")

# dummy var for high blodd pressure history
dat$father_high_blood_pressure <- ifelse(rowSums(dat[f] == "High blood pressure", na.rm = TRUE) > 0, 1, 
                                         ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$father_high_blood_pressure)
dat$father_high_blood_pressure <- recode_factor(dat$father_high_blood_pressure,
                                                "0" = "No",
                                                "1" = "Yes")

# dummy var for chronic bronchitis/emphysema history
dat$father_bronchitis_emphysema <- ifelse(rowSums(dat[f] == "Chronic bronchitis/emphysema", na.rm = TRUE) > 0, 1, 
                                          ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$father_bronchitis_emphysema)
dat$father_bronchitis_emphysema <- recode_factor(dat$father_bronchitis_emphysema,
                                                 "0" = "No",
                                                 "1" = "Yes")

# dummy var for Prostate cancer history
dat$father_prostate_cancer <- ifelse(rowSums(dat[f] == "Prostate cancer", na.rm = TRUE) > 0, 1, 
                                     ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$father_prostate_cancer)
dat$father_prostate_cancer <- recode_factor(dat$father_prostate_cancer,
                                            "0" = "No",
                                            "1" = "Yes")

# dummy var for bowelcancer history
dat$father_bowel_cancer <- ifelse(rowSums(dat[f] == "Bowel cancer", na.rm = TRUE) > 0, 1, 
                                  ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$father_bowel_cancer)
dat$father_bowel_cancer <- recode_factor(dat$father_bowel_cancer,
                                         "0" = "No",
                                         "1" = "Yes")

# dummy var for lung cancer history
dat$father_lung_cancer <- ifelse(rowSums(dat[f] == "Lung cancer", na.rm = TRUE) > 0, 1, 
                                 ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$father_lung_cancer)
dat$father_lung_cancer <- recode_factor(dat$father_lung_cancer,
                                        "0" = "No",
                                        "1" = "Yes")

# dummy var for stroke history
dat$father_stroke <- ifelse(rowSums(dat[f] == "Stroke", na.rm = TRUE) > 0, 1, 
                            ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$father_stroke)
dat$father_stroke <- recode_factor(dat$father_stroke,
                                   "0" = "No",
                                   "1" = "Yes")

# dummy var for heart disease history
dat$father_heart_disease <- ifelse(rowSums(dat[f] == "Heart disease", na.rm = TRUE) > 0, 1, 
                                   ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$father_heart_disease)
dat$father_heart_disease <- recode_factor(dat$father_heart_disease,
                                          "0" = "No",
                                          "1" = "Yes")

## adopted father illness history

prefix <- "adopted_father_illness.0."
suffix <- seq(0,6)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]

# dummy var for alzheimer's history
dat$adopted_father_alzheimers <- ifelse(rowSums(dat[f] == "Alzheimer's disease/dementia", na.rm = TRUE) > 0, 1, 
                                        ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_father_alzheimers)
dat$adopted_father_alzheimers <- recode_factor(dat$adopted_father_alzheimers,
                                               "0" = "No",
                                               "1" = "Yes")

# dummy var for severe depression history
dat$adopted_father_severe_depression <- ifelse(rowSums(dat[f] == "Severe depression", na.rm = TRUE) > 0, 1, 
                                               ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_father_severe_depression)
dat$adopted_father_severe_depression <- recode_factor(dat$adopted_father_severe_depression,
                                                      "0" = "No",
                                                      "1" = "Yes")

# dummy var for parkinsons history
dat$adopted_father_parkinsons <- ifelse(rowSums(dat[f] == "Parkinson's disease", na.rm = TRUE) > 0, 1,
                                        ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_father_parkinsons)
dat$adopted_father_parkinsons <- recode_factor(dat$adopted_father_parkinsons,
                                               "0" = "No",
                                               "1" = "Yes")

# dummy var for diabetes history
dat$adopted_father_diabetes <- ifelse(rowSums(dat[f] == "Diabetes", na.rm = TRUE) > 0, 1, 
                                      ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_father_diabetes)
dat$adopted_father_diabetes <- recode_factor(dat$adopted_father_diabetes,
                                             "0" = "No",
                                             "1" = "Yes")

# dummy var for high blodd pressure history
dat$adopted_father_high_blood_pressure <- ifelse(rowSums(dat[f] == "High blood pressure", na.rm = TRUE) > 0, 1, 
                                                 ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_father_high_blood_pressure)
dat$adopted_father_high_blood_pressure <- recode_factor(dat$adopted_father_high_blood_pressure,
                                                        "0" = "No",
                                                        "1" = "Yes")

# dummy var for chronic bronchitis/emphysema history
dat$adopted_father_bronchitis_emphysema <- ifelse(rowSums(dat[f] == "Chronic bronchitis/emphysema", na.rm = TRUE) > 0, 1, 
                                                  ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_father_bronchitis_emphysema)
dat$adopted_father_bronchitis_emphysema <- recode_factor(dat$adopted_father_bronchitis_emphysema,
                                                         "0" = "No",
                                                         "1" = "Yes")

# dummy var for Prostate cancer history
dat$adopted_father_prostate_cancer <- ifelse(rowSums(dat[f] == "Prostate cancer", na.rm = TRUE) > 0, 1, 
                                             ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_father_prostate_cancer)
dat$adopted_father_prostate_cancer <- recode_factor(dat$adopted_father_prostate_cancer,
                                                    "0" = "No",
                                                    "1" = "Yes")

# dummy var for bowelcancer history
dat$adopted_father_bowel_cancer <- ifelse(rowSums(dat[f] == "Bowel cancer", na.rm = TRUE) > 0, 1, 
                                          ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_father_bowel_cancer)
dat$adopted_father_bowel_cancer <- recode_factor(dat$adopted_father_bowel_cancer,
                                                 "0" = "No",
                                                 "1" = "Yes")

# dummy var for lung cancer history
dat$adopted_father_lung_cancer <- ifelse(rowSums(dat[f] == "Lung cancer", na.rm = TRUE) > 0, 1, 
                                         ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_father_lung_cancer)
dat$adopted_father_lung_cancer <- recode_factor(dat$adopted_father_lung_cancer,
                                                "0" = "No",
                                                "1" = "Yes")

# dummy var for stroke history
dat$adopted_father_stroke <- ifelse(rowSums(dat[f] == "Stroke", na.rm = TRUE) > 0, 1, 
                                    ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_father_stroke)
dat$adopted_father_stroke <- recode_factor(dat$adopted_father_stroke,
                                           "0" = "No",
                                           "1" = "Yes")

# dummy var for heart disease history
dat$adopted_father_heart_disease <- ifelse(rowSums(dat[f] == "Heart disease", na.rm = TRUE) > 0, 1, 
                                           ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_father_heart_disease)
dat$adopted_father_heart_disease <- recode_factor(dat$adopted_father_heart_disease,
                                                  "0" = "No",
                                                  "1" = "Yes")

## sibling illness history

prefix <- "sibling_illness.0."
suffix <- seq(0,11)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]

# dummy var for alzheimer's history
dat$sibling_alzheimers <- ifelse(rowSums(dat[f] == "Alzheimer's disease/dementia", na.rm = TRUE) > 0, 1, 
                                ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$sibling_alzheimers)
dat$sibling_alzheimers <- recode_factor(dat$sibling_alzheimers,
                                       "0" = "No",
                                       "1" = "Yes")

# dummy var for severe depression history
dat$sibling_severe_depression <- ifelse(rowSums(dat[f] == "Severe depression", na.rm = TRUE) > 0, 1, 
                                       ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$sibling_severe_depression)
dat$sibling_severe_depression <- recode_factor(dat$sibling_severe_depression,
                                              "0" = "No",
                                              "1" = "Yes")

# dummy var for parkinsons history
dat$sibling_parkinsons <- ifelse(rowSums(dat[f] == "Parkinson's disease", na.rm = TRUE) > 0, 1,
                                ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$sibling_parkinsons)
dat$sibling_parkinsons <- recode_factor(dat$sibling_parkinsons,
                                       "0" = "No",
                                       "1" = "Yes")

# dummy var for diabetes history
dat$sibling_diabetes <- ifelse(rowSums(dat[f] == "Diabetes", na.rm = TRUE) > 0, 1, 
                              ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$sibling_diabetes)
dat$sibling_diabetes <- recode_factor(dat$sibling_diabetes,
                                     "0" = "No",
                                     "1" = "Yes")

# dummy var for high blodd pressure history
dat$sibling_high_blood_pressure <- ifelse(rowSums(dat[f] == "High blood pressure", na.rm = TRUE) > 0, 1, 
                                         ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$sibling_high_blood_pressure)
dat$sibling_high_blood_pressure <- recode_factor(dat$sibling_high_blood_pressure,
                                                "0" = "No",
                                                "1" = "Yes")

# dummy var for chronic bronchitis/emphysema history
dat$sibling_bronchitis_emphysema <- ifelse(rowSums(dat[f] == "Chronic bronchitis/emphysema", na.rm = TRUE) > 0, 1, 
                                          ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$sibling_bronchitis_emphysema)
dat$sibling_bronchitis_emphysema <- recode_factor(dat$sibling_bronchitis_emphysema,
                                                 "0" = "No",
                                                 "1" = "Yes")

# dummy var for Breast cancer history
dat$sibling_breast_cancer <- ifelse(rowSums(dat[f] == "Breast cancer", na.rm = TRUE) > 0, 1, 
                                   ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$sibling_breast_cancer)
dat$sibling_breast_cancer <- recode_factor(dat$sibling_breast_cancer,
                                          "0" = "No",
                                          "1" = "Yes")

# dummy var for Prostate cancer history
dat$sibling_prostate_cancer <- ifelse(rowSums(dat[f] == "Prostate cancer", na.rm = TRUE) > 0, 1, 
                                      ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$sibling_prostate_cancer)
dat$sibling_prostate_cancer <- recode_factor(dat$sibling_prostate_cancer,
                                             "0" = "No",
                                             "1" = "Yes")

# dummy var for bowelcancer history
dat$sibling_bowel_cancer <- ifelse(rowSums(dat[f] == "Bowel cancer", na.rm = TRUE) > 0, 1, 
                                  ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$sibling_bowel_cancer)
dat$sibling_bowel_cancer <- recode_factor(dat$sibling_bowel_cancer,
                                         "0" = "No",
                                         "1" = "Yes")

# dummy var for lung cancer history
dat$sibling_lung_cancer <- ifelse(rowSums(dat[f] == "Lung cancer", na.rm = TRUE) > 0, 1, 
                                 ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$sibling_lung_cancer)
dat$sibling_lung_cancer <- recode_factor(dat$sibling_lung_cancer,
                                        "0" = "No",
                                        "1" = "Yes")

# dummy var for stroke history
dat$sibling_stroke <- ifelse(rowSums(dat[f] == "Stroke", na.rm = TRUE) > 0, 1, 
                            ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$sibling_stroke)
dat$sibling_stroke <- recode_factor(dat$sibling_stroke,
                                   "0" = "No",
                                   "1" = "Yes")

# dummy var for heart disease history
dat$sibling_heart_disease <- ifelse(rowSums(dat[f] == "Heart disease", na.rm = TRUE) > 0, 1, 
                                   ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$sibling_heart_disease)
dat$sibling_heart_disease <- recode_factor(dat$sibling_heart_disease,
                                          "0" = "No",
                                          "1" = "Yes")

## adopted sibling illness history

prefix <- "adopted_sibling_illness.0."
suffix <- seq(0,6)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]

# dummy var for alzheimer's history
dat$adopted_sibling_alzheimers <- ifelse(rowSums(dat[f] == "Alzheimer's disease/dementia", na.rm = TRUE) > 0, 1, 
                                        ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_sibling_alzheimers)
dat$adopted_sibling_alzheimers <- recode_factor(dat$adopted_sibling_alzheimers,
                                               "0" = "No",
                                               "1" = "Yes")

# dummy var for severe depression history
dat$adopted_sibling_severe_depression <- ifelse(rowSums(dat[f] == "Severe depression", na.rm = TRUE) > 0, 1, 
                                               ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_sibling_severe_depression)
dat$adopted_sibling_severe_depression <- recode_factor(dat$adopted_sibling_severe_depression,
                                                      "0" = "No",
                                                      "1" = "Yes")

# dummy var for parkinsons history
dat$adopted_sibling_parkinsons <- ifelse(rowSums(dat[f] == "Parkinson's disease", na.rm = TRUE) > 0, 1,
                                        ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_sibling_parkinsons)
dat$adopted_sibling_parkinsons <- recode_factor(dat$adopted_sibling_parkinsons,
                                               "0" = "No",
                                               "1" = "Yes")

# dummy var for diabetes history
dat$adopted_sibling_diabetes <- ifelse(rowSums(dat[f] == "Diabetes", na.rm = TRUE) > 0, 1, 
                                      ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_sibling_diabetes)
dat$adopted_sibling_diabetes <- recode_factor(dat$adopted_sibling_diabetes,
                                             "0" = "No",
                                             "1" = "Yes")

# dummy var for high blodd pressure history
dat$adopted_sibling_high_blood_pressure <- ifelse(rowSums(dat[f] == "High blood pressure", na.rm = TRUE) > 0, 1, 
                                                 ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_sibling_high_blood_pressure)
dat$adopted_sibling_high_blood_pressure <- recode_factor(dat$adopted_sibling_high_blood_pressure,
                                                        "0" = "No",
                                                        "1" = "Yes")

# dummy var for chronic bronchitis/emphysema history
dat$adopted_sibling_bronchitis_emphysema <- ifelse(rowSums(dat[f] == "Chronic bronchitis/emphysema", na.rm = TRUE) > 0, 1, 
                                                  ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_sibling_bronchitis_emphysema)
dat$adopted_sibling_bronchitis_emphysema <- recode_factor(dat$adopted_sibling_bronchitis_emphysema,
                                                         "0" = "No",
                                                         "1" = "Yes")

# dummy var for breast cancer history
dat$adopted_sibling_breast_cancer <- ifelse(rowSums(dat[f] == "Breast cancer", na.rm = TRUE) > 0, 1, 
                                           ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_sibling_breast_cancer)
dat$adopted_sibling_breast_cancer <- recode_factor(dat$adopted_sibling_breast_cancer,
                                                  "0" = "No",
                                                  "1" = "Yes")

# dummy var for Prostate cancer history
dat$adopted_sibling_prostate_cancer <- ifelse(rowSums(dat[f] == "Prostate cancer", na.rm = TRUE) > 0, 1, 
                                              ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_sibling_prostate_cancer)
dat$adopted_sibling_prostate_cancer <- recode_factor(dat$adopted_sibling_prostate_cancer,
                                                     "0" = "No",
                                                     "1" = "Yes")

# dummy var for bowelcancer history
dat$adopted_sibling_bowel_cancer <- ifelse(rowSums(dat[f] == "Bowel cancer", na.rm = TRUE) > 0, 1, 
                                          ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_sibling_bowel_cancer)
dat$adopted_sibling_bowel_cancer <- recode_factor(dat$adopted_sibling_bowel_cancer,
                                                 "0" = "No",
                                                 "1" = "Yes")

# dummy var for lung cancer history
dat$adopted_sibling_lung_cancer <- ifelse(rowSums(dat[f] == "Lung cancer", na.rm = TRUE) > 0, 1, 
                                         ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_sibling_lung_cancer)
dat$adopted_sibling_lung_cancer <- recode_factor(dat$adopted_sibling_lung_cancer,
                                                "0" = "No",
                                                "1" = "Yes")

# dummy var for stroke history
dat$adopted_sibling_stroke <- ifelse(rowSums(dat[f] == "Stroke", na.rm = TRUE) > 0, 1, 
                                    ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_sibling_stroke)
dat$adopted_sibling_stroke <- recode_factor(dat$adopted_sibling_stroke,
                                           "0" = "No",
                                           "1" = "Yes")

# dummy var for heart disease history
dat$adopted_sibling_heart_disease <- ifelse(rowSums(dat[f] == "Heart disease", na.rm = TRUE) > 0, 1, 
                                           ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$adopted_sibling_heart_disease)
dat$adopted_sibling_heart_disease <- recode_factor(dat$adopted_sibling_heart_disease,
                                                  "0" = "No",
                                                  "1" = "Yes")

#remove columns used to make dummy vars
dat <- subset(dat, select = -c(adopted_father_illness.0.0,
                               adopted_father_illness.0.1,
                               adopted_father_illness.0.2,
                               adopted_father_illness.0.3,
                               adopted_father_illness.0.4,
                               adopted_father_illness.0.5,
                               adopted_father_illness.0.6,
                               adopted_mother_illness.0.0,
                               adopted_mother_illness.0.1,
                               adopted_mother_illness.0.2,
                               adopted_mother_illness.0.3,
                               adopted_mother_illness.0.4,
                               adopted_mother_illness.0.5,
                               adopted_sibling_illness.0.0,
                               adopted_sibling_illness.0.1,
                               adopted_sibling_illness.0.2,
                               adopted_sibling_illness.0.3,
                               adopted_sibling_illness.0.4,
                               adopted_sibling_illness.0.5,
                               adopted_sibling_illness.0.6,
                               father_illness.0.0,
                               father_illness.0.1,
                               father_illness.0.2,
                               father_illness.0.3,
                               father_illness.0.4,
                               father_illness.0.5,
                               father_illness.0.6,
                               father_illness.0.7,
                               father_illness.0.8,
                               father_illness.0.9,
                               mother_illness.0.0,
                               mother_illness.0.1,
                               mother_illness.0.2,
                               mother_illness.0.3,
                               mother_illness.0.4,
                               mother_illness.0.5,
                               mother_illness.0.6,
                               mother_illness.0.7,
                               mother_illness.0.8,
                               mother_illness.0.9,
                               mother_illness.0.10,
                               sibling_illness.0.0,
                               sibling_illness.0.1,
                               sibling_illness.0.2,
                               sibling_illness.0.3,
                               sibling_illness.0.4,
                               sibling_illness.0.5,
                               sibling_illness.0.6,
                               sibling_illness.0.7,
                               sibling_illness.0.8,
                               sibling_illness.0.9,
                               sibling_illness.0.10,
                               sibling_illness.0.11))
```
<br /> 

### Medical conditions
```{r med_cond, results='hide'}

sort(unique(dat$MI_diagnosis_age))
sort(unique(dat$angina_diagnosis_age))
sort(unique(dat$stroke_diagnosis_age))
sort(unique(dat$bp_diagnosis_age))
sort(unique(dat$DVT_diagnosis_age))
sort(unique(dat$pulm_embolism_diagnosis_age))
sort(unique(dat$emphysema_diagnosis_age))
sort(unique(dat$asthma_diagnosis_age))
sort(unique(dat$rhinitis_diagnosis_age))
unique(dat$diabetes_diagnosis)
unique(dat$gest_diabetes_only)
sort(unique(dat$diabetes_diagnosis_age))
unique(dat$cancer_diagnosis)
unique(dat$fracture_last_5yrs)
unique(dat$fracture_fall)
unique(dat$other_diagnosis)
sort(unique(dat$number_cancers))
sort(unique(dat$number_illnesses))
unique(dat$glasses)
sort(unique(dat$glasses_age))
unique(dat$myopia_eye)
unique(dat$hypertropia_eye)
unique(dat$presbyopia_eye)
unique(dat$astigmatism_eye)
unique(dat$strabismus_eye)
unique(dat$amblyopia_eye)
unique(dat$other_eye)
unique(dat$other_serious_eye)
unique(dat$other_eye_problems)
unique(dat$diabetes_eye)
unique(dat$glaucoma_eye)
unique(dat$injury_eye)
unique(dat$cataract_eye)
unique(dat$macular_degeneration_eye)
sort(unique(dat$diabetes_eye_age))
sort(unique(dat$glaucoma_age))
sort(unique(dat$injury_eye_age))
sort(unique(dat$cataract_age))
sort(unique(dat$macular_degeneration_age))
sort(unique(dat$other_serious_eye_age))
unique(dat$overall_health)
unique(dat$chronic_illness)
unique(dat$falls_last_1yr)
unique(dat$weight_change_last_1yr)
unique(dat$chest_weeze_last_1yr)
unique(dat$shortness_breath)
unique(dat$leg_pain_walking)
unique(dat$leg_pain_standing)
unique(dat$leg_pain_calves)
unique(dat$leg_pain_walking_uphill)
unique(dat$leg_pain_walking_normal)
unique(dat$leg_pain_walking_disappears)
unique(dat$leg_pain_walking_action)
unique(dat$leg_pain_walking_standing)
unique(dat$leg_artery_surgery)
unique(dat$leg_surgery)
unique(dat$headaches_3months)
unique(dat$facial_pain_3months)
unique(dat$neck_pain_3months)
unique(dat$stomach_pain_3months)
unique(dat$back_pain_3months)
unique(dat$hip_pain_3months)
unique(dat$knee_pain_3months)
unique(dat$general_pain_3months)
unique(dat$chest_pain)
unique(dat$chest_pain_walking_normal)
unique(dat$chest_pain_ceases_still)
unique(dat$chest_pain_walking_uphill)
unique(dat$major_operations)
unique(dat$other_operations)
sort(unique(dat$number_operations))
unique(dat$pace_maker)
unique(dat$hearing_difficulty)
unique(dat$hearing_difficulty_background)
unique(dat$hearing_aid)
unique(dat$cochlear_implant)
unique(dat$tinnitus)
unique(dat$tinnitus_severity)
unique(dat$loud_music_exposure)
levels(dat$loud_music_exposure)
unique(dat$bowel_cancer_screening)
sort(unique(dat$bowel_cancer_screening_recent))
unique(dat$PSA_test)
sort(unique(dat$PSA_test_time_since))


# convert to factors / numeric
# make unordered
# set reference category

dat$MI_diagnosis_age <- as.numeric(dat$MI_diagnosis_age)
dat$MI_diagnosis_age[which(dat$MI_diagnosis_age == "-3")] <- NA         
dat$MI_diagnosis_age[which(dat$MI_diagnosis_age == "-1")] <- NA               

dat$angina_diagnosis_age <- as.numeric(dat$angina_diagnosis_age)
dat$angina_diagnosis_age[which(dat$angina_diagnosis_age == "-3")] <- NA         
dat$angina_diagnosis_age[which(dat$angina_diagnosis_age == "-1")] <- NA               

dat$stroke_diagnosis_age <- as.numeric(dat$stroke_diagnosis_age)
dat$stroke_diagnosis_age[which(dat$stroke_diagnosis_age == "-3")] <- NA         
dat$stroke_diagnosis_age[which(dat$stroke_diagnosis_age == "-1")] <- NA               

dat$bp_diagnosis_age <- as.numeric(dat$bp_diagnosis_age)
dat$bp_diagnosis_age[which(dat$bp_diagnosis_age == "-3")] <- NA         
dat$bp_diagnosis_age[which(dat$bp_diagnosis_age == "-1")] <- NA               

dat$DVT_diagnosis_age <- as.numeric(dat$DVT_diagnosis_age)
dat$DVT_diagnosis_age[which(dat$DVT_diagnosis_age == "-3")] <- NA         
dat$DVT_diagnosis_age[which(dat$DVT_diagnosis_age == "-1")] <- NA               

dat$pulm_embolism_diagnosis_age <- as.numeric(dat$pulm_embolism_diagnosis_age)
dat$pulm_embolism_diagnosis_age[which(dat$pulm_embolism_diagnosis_age == "-3")] <- NA         
dat$pulm_embolism_diagnosis_age[which(dat$pulm_embolism_diagnosis_age == "-1")] <- NA               

dat$emphysema_diagnosis_age <- as.numeric(dat$emphysema_diagnosis_age)
dat$emphysema_diagnosis_age[which(dat$emphysema_diagnosis_age == "-3")] <- NA         
dat$emphysema_diagnosis_age[which(dat$emphysema_diagnosis_age == "-1")] <- NA               

dat$asthma_diagnosis_age <- as.numeric(dat$asthma_diagnosis_age)
dat$asthma_diagnosis_age[which(dat$asthma_diagnosis_age == "-3")] <- NA         
dat$asthma_diagnosis_age[which(dat$asthma_diagnosis_age == "-1")] <- NA               

dat$rhinitis_diagnosis_age <- as.numeric(dat$rhinitis_diagnosis_age)
dat$rhinitis_diagnosis_age[which(dat$rhinitis_diagnosis_age == "-3")] <- NA         
dat$rhinitis_diagnosis_age[which(dat$rhinitis_diagnosis_age == "-1")] <- NA               

dat$diabetes_diagnosis <- factor(dat$diabetes_diagnosis, ordered = FALSE)
dat$diabetes_diagnosis <- relevel(dat$diabetes_diagnosis, ref = "No")

dat$gest_diabetes_only <- factor(dat$gest_diabetes_only, ordered = FALSE)
dat$gest_diabetes_only <- relevel(dat$gest_diabetes_only, ref = "No")

dat$diabetes_diagnosis_age[which(dat$diabetes_diagnosis_age == "-3")] <- NA         
dat$diabetes_diagnosis_age[which(dat$diabetes_diagnosis_age == "-1")] <- NA               
dat$diabetes_diagnosis_age <- as.numeric(dat$diabetes_diagnosis_age)

dat$cancer_diagnosis <- factor(dat$cancer_diagnosis, ordered = FALSE)
dat$cancer_diagnosis <- recode_factor(dat$cancer_diagnosis, 
                                      "No" = "No",
                                      "Yes - you will be asked about this later by an interviewer" = "Yes")
dat$cancer_diagnosis <- relevel(dat$cancer_diagnosis, ref = "No")

dat$fracture_last_5yrs <- factor(dat$fracture_last_5yrs, ordered = FALSE)
dat$fracture_last_5yrs <- relevel(dat$fracture_last_5yrs, ref = "No")

dat$fracture_fall <- factor(dat$fracture_fall, ordered = FALSE)
dat$fracture_fall <- relevel(dat$fracture_fall, ref = "No")

dat$other_diagnosis <- factor(dat$cancer_diagnosis, ordered = FALSE)
dat$other_diagnosis <- recode_factor(dat$other_diagnosis, 
                                     "No" = "No",
                                     "Yes - you will be asked about this later by an interviewer" = "Yes")
dat$other_diagnosis <- relevel(dat$other_diagnosis, ref = "No")

dat$number_cancers <- as.numeric(dat$number_cancers)

dat$number_illnesses <- as.numeric(dat$number_illnesses)

dat$glasses <- factor(dat$glasses, ordered = FALSE)
dat$glasses <- relevel(dat$glasses, ref = "No")

dat$glasses_age <- as.numeric(dat$glasses_age)
dat$glasses_age[which(dat$glasses_age == "-3")] <- NA         
dat$glasses_age[which(dat$glasses_age == "-1")] <- NA               

eye_first <- match("myopia_eye",names(dat)) # col #
eye_last <- match("other_serious_eye",names(dat)) # col #
table(dat[eye_first:eye_last]) # check to see the most common response to set as the ref level

dat$myopia_eye <- factor(dat$myopia_eye, ordered = FALSE)
dat$myopia_eye <- relevel(dat$myopia_eye, ref = "Both eyes")

dat$hypertropia_eye <- factor(dat$hypertropia_eye, ordered = FALSE)
dat$hypertropia_eye <- relevel(dat$hypertropia_eye, ref = "Both eyes")

dat$presbyopia_eye <- factor(dat$presbyopia_eye, ordered = FALSE)
dat$presbyopia_eye <- relevel(dat$presbyopia_eye, ref = "Both eyes")

dat$astigmatism_eye <- factor(dat$astigmatism_eye, ordered = FALSE)
dat$astigmatism_eye <- relevel(dat$astigmatism_eye, ref = "Both eyes")

dat$strabismus_eye <- factor(dat$strabismus_eye, ordered = FALSE)
dat$strabismus_eye <- relevel(dat$strabismus_eye, ref = "Left eye")

dat$amblyopia_eye <- factor(dat$amblyopia_eye, ordered = FALSE)
dat$amblyopia_eye <- relevel(dat$amblyopia_eye, ref = "Left eye")

dat$other_eye <- factor(dat$other_eye, ordered = FALSE)
dat$other_eye <- relevel(dat$other_eye, ref = "Both eyes")

dat$other_serious_eye <- factor(dat$other_serious_eye, ordered = FALSE)
dat$other_serious_eye <- relevel(dat$other_serious_eye, ref = "Both eyes")

dat$other_eye_problems <- factor(dat$other_eye_problems, ordered = FALSE)
dat$other_eye_problems <- relevel(dat$other_eye_problems, ref = "No")

eye_first2 <- match("diabetes_eye",names(dat)) # col #211
eye_last2 <- match("macular_degeneration_eye",names(dat)) # col #215
table(dat[eye_first2:eye_last2]) # check to see the most common response to set as the ref level

dat$diabetes_eye <- factor(dat$diabetes_eye, ordered = FALSE)
dat$diabetes_eye <- relevel(dat$diabetes_eye, ref = "Both eyes")

dat$glaucoma_eye <- factor(dat$glaucoma_eye, ordered = FALSE)
dat$glaucoma_eye <- relevel(dat$glaucoma_eye, ref = "Both eyes")

dat$injury_eye <- factor(dat$injury_eye, ordered = FALSE)
dat$injury_eye <- relevel(dat$injury_eye, ref = "Left eye")

dat$cataract_eye <- factor(dat$cataract_eye, ordered = FALSE)
dat$cataract_eye <- relevel(dat$cataract_eye, ref = "Both eyes")

dat$macular_degeneration_eye <- factor(dat$macular_degeneration_eye, ordered = FALSE)
dat$macular_degeneration_eye <- relevel(dat$macular_degeneration_eye, ref = "Both eyes")

dat$diabetes_eye_age <- as.numeric(dat$diabetes_eye_age)
dat$diabetes_eye_age[which(dat$diabetes_eye_age == "-3")] <- NA         
dat$diabetes_eye_age[which(dat$diabetes_eye_age == "-1")] <- NA      

dat$glaucoma_age <- as.numeric(dat$glaucoma_age)
dat$glaucoma_age[which(dat$glaucoma_age == "-3")] <- NA         
dat$glaucoma_age[which(dat$glaucoma_age == "-1")] <- NA               

dat$injury_eye_age <- as.numeric(dat$injury_eye_age)
dat$injury_eye_age[which(dat$injury_eye_age == "-3")] <- NA         
dat$injury_eye_age[which(dat$injury_eye_age == "-1")] <- NA               

dat$cataract_age <- as.numeric(dat$cataract_age)
dat$cataract_age[which(dat$cataract_age == "-3")] <- NA         
dat$cataract_age[which(dat$cataract_age == "-1")] <- NA               

dat$macular_degeneration_age <- as.numeric(dat$macular_degeneration_age)
dat$macular_degeneration_age[which(dat$macular_degeneration_age == "-3")] <- NA         
dat$macular_degeneration_age[which(dat$macular_degeneration_age == "-1")] <- NA               

dat$other_serious_eye_age <- as.numeric(dat$other_serious_eye_age)
dat$other_serious_eye_age[which(dat$other_serious_eye_age == "-3")] <- NA         
dat$other_serious_eye_age[which(dat$other_serious_eye_age == "-1")] <- NA               

dat$overall_health <- factor(dat$overall_health, ordered = FALSE)
dat$overall_health <- relevel(dat$overall_health, ref = "Poor")

dat$chronic_illness <- factor(dat$chronic_illness, ordered = FALSE)
dat$chronic_illness <- relevel(dat$chronic_illness, ref = "No")

dat$falls_last_1yr <- factor(dat$falls_last_1yr, ordered = FALSE)
dat$falls_last_1yr <- relevel(dat$falls_last_1yr, ref = "No falls")

dat$weight_change_last_1yr <- factor(dat$weight_change_last_1yr, ordered = FALSE)
dat$weight_change_last_1yr <- relevel(dat$weight_change_last_1yr, ref = "No - weigh about the same")

dat$chest_weeze_last_1yr <- factor(dat$chest_weeze_last_1yr, ordered = FALSE)
dat$chest_weeze_last_1yr <- relevel(dat$chest_weeze_last_1yr, ref = "No")

dat$shortness_breath <- factor(dat$shortness_breath, ordered = FALSE)
dat$shortness_breath <- relevel(dat$shortness_breath, ref = "No")

dat$leg_pain_walking <- factor(dat$leg_pain_walking, ordered = FALSE)
dat$leg_pain_walking <- relevel(dat$leg_pain_walking, ref = "No")

dat$leg_pain_standing <- factor(dat$leg_pain_standing, ordered = FALSE)
dat$leg_pain_standing <- relevel(dat$leg_pain_standing, ref = "No")

dat$leg_pain_calves <- factor(dat$leg_pain_calves, ordered = FALSE)
dat$leg_pain_calves <- relevel(dat$leg_pain_calves, ref = "No")

dat$leg_pain_walking_uphill <- factor(dat$leg_pain_walking_uphill, ordered = FALSE)
dat$leg_pain_walking_uphill <- relevel(dat$leg_pain_walking_uphill, ref = "No")

dat$leg_pain_walking_normal <- factor(dat$leg_pain_walking_normal, ordered = FALSE)
dat$leg_pain_walking_normal <- relevel(dat$leg_pain_walking_normal, ref = "No")

dat$leg_pain_walking_disappears <- factor(dat$leg_pain_walking_disappears, ordered = FALSE)
dat$leg_pain_walking_disappears <- relevel(dat$leg_pain_walking_disappears, ref = "No")

table(dat$leg_pain_walking_action) # check to see the most common response to set as the ref level
dat$leg_pain_walking_action <- factor(dat$leg_pain_walking_action, ordered = FALSE)
dat$leg_pain_walking_action <- relevel(dat$leg_pain_walking_action, ref = "Slow down")

table(dat$leg_pain_walking_standing) # check to see the most common response to set as the ref level
dat$leg_pain_walking_standing <- factor(dat$leg_pain_walking_standing, ordered = FALSE)
dat$leg_pain_walking_standing <- relevel(dat$leg_pain_walking_standing, ref = "Pain usually disappears in less than 10 minutes")

dat$leg_artery_surgery <- factor(dat$leg_artery_surgery, ordered = FALSE)
dat$leg_artery_surgery <- relevel(dat$leg_artery_surgery, ref = "No")

dat$leg_surgery <- factor(dat$leg_surgery, ordered = FALSE)
dat$leg_surgery <- relevel(dat$leg_surgery, ref = "No")

dat$headaches_3months <- factor(dat$headaches_3months, ordered = FALSE)
dat$headaches_3months <- relevel(dat$headaches_3months, ref = "No")

dat$facial_pain_3months <- factor(dat$facial_pain_3months, ordered = FALSE)
dat$facial_pain_3months <- relevel(dat$facial_pain_3months, ref = "No")

dat$neck_pain_3months <- factor(dat$neck_pain_3months, ordered = FALSE)
dat$neck_pain_3months <- relevel(dat$neck_pain_3months, ref = "No")

dat$stomach_pain_3months <- factor(dat$stomach_pain_3months, ordered = FALSE)
dat$stomach_pain_3months <- relevel(dat$stomach_pain_3months, ref = "No")

dat$back_pain_3months <- factor(dat$back_pain_3months, ordered = FALSE)
dat$back_pain_3months <- relevel(dat$back_pain_3months, ref = "No")

dat$hip_pain_3months <- factor(dat$hip_pain_3months, ordered = FALSE)
dat$hip_pain_3months <- relevel(dat$hip_pain_3months, ref = "No")

dat$knee_pain_3months <- factor(dat$knee_pain_3months, ordered = FALSE)
dat$knee_pain_3months <- relevel(dat$knee_pain_3months, ref = "No")

dat$general_pain_3months <- factor(dat$general_pain_3months, ordered = FALSE)
dat$general_pain_3months <- relevel(dat$general_pain_3months, ref = "No")

dat$chest_pain <- factor(dat$chest_pain, ordered = FALSE)
dat$chest_pain <- relevel(dat$chest_pain, ref = "No")

table(dat$chest_pain_walking_normal) # check to see the most common response to set as the ref level
dat$chest_pain_walking_normal <- factor(dat$chest_pain_walking_normal, ordered = FALSE)
dat$chest_pain_walking_normal <- relevel(dat$chest_pain_walking_normal, ref = "No")

dat$chest_pain_ceases_still <- factor(dat$chest_pain_ceases_still, ordered = FALSE)
dat$chest_pain_ceases_still <- relevel(dat$chest_pain_ceases_still, ref = "No")

dat$chest_pain_walking_uphill <- factor(dat$chest_pain_walking_uphill, ordered = FALSE)
dat$chest_pain_walking_uphill <- relevel(dat$chest_pain_walking_uphill, ref = "No")

dat$major_operations <- factor(dat$major_operations, ordered = FALSE)
dat$major_operations <- recode_factor(dat$major_operations, 
                                     "No" = "No",
                                     "Yes - you will be asked about this later by an interviewer" = "Yes")
dat$major_operations <- relevel(dat$major_operations, ref = "No")

dat$other_operations <- factor(dat$other_operations, ordered = FALSE)
dat$other_operations <- recode_factor(dat$other_operations, 
                                     "No" = "No",
                                     "Yes - you will be asked about this later by an interviewer" = "Yes")
dat$other_operations <- relevel(dat$other_operations, ref = "No")

dat$pace_maker <- factor(dat$pace_maker, ordered = FALSE)
dat$pace_maker <- relevel(dat$pace_maker, ref = "No")

dat$hearing_difficulty <- factor(dat$hearing_difficulty, ordered = FALSE)
dat$hearing_difficulty <- relevel(dat$hearing_difficulty, ref = "No")

dat$hearing_difficulty_background <- factor(dat$hearing_difficulty_background, ordered = FALSE)
dat$hearing_difficulty_background <- relevel(dat$hearing_difficulty_background, ref = "No")

dat$hearing_aid <- factor(dat$hearing_aid, ordered = FALSE)
dat$hearing_aid <- relevel(dat$hearing_aid, ref = "No")

dat$cochlear_implant <- factor(dat$cochlear_implant, ordered = FALSE)
dat$cochlear_implant <- relevel(dat$cochlear_implant, ref = "No")

# needed to re-order the response categories
dat$tinnitus <- factor(dat$tinnitus, levels = c("No, never",
                                                "Yes, but not now, but have in the past",
                                                "Yes, now some of the time",
                                                "Yes, now a lot of the time",
                                                "Yes, now most or all of the time"), ordered = FALSE)
dat$tinnitus <- relevel(dat$tinnitus, ref = "No, never")

# needed to re-order the response categories
dat$tinnitus_severity <- factor(dat$tinnitus_severity, levels = c("Not at all",
                                                                  "Slightly",
                                                                  "Moderately",
                                                                  "Severely"), ordered = FALSE)
dat$tinnitus_severity <- relevel(dat$tinnitus_severity, ref = "Not at all")

# needed to re-order the response categories
dat$loud_music_exposure <- factor(dat$loud_music_exposure, levels = c("No",
                                                                      "Yes, for less than a year",
                                                                      "Yes, for around 1-5 years",
                                                                      "Yes, for more than 5 years"), ordered = FALSE)
dat$loud_music_exposure <- relevel(dat$loud_music_exposure, ref = "No")

dat$bowel_cancer_screening <- factor(dat$bowel_cancer_screening, ordered = FALSE)
dat$bowel_cancer_screening <- relevel(dat$bowel_cancer_screening, ref = "No")

dat$bowel_cancer_screening_recent <- as.numeric(dat$bowel_cancer_screening_recent)
dat$bowel_cancer_screening_recent[which(dat$bowel_cancer_screening_recent == "-10")] <- 0.5         
dat$bowel_cancer_screening_recent[which(dat$bowel_cancer_screening_recent == "-3")] <- NA         
dat$bowel_cancer_screening_recent[which(dat$bowel_cancer_screening_recent == "-1")] <- NA               

dat$PSA_test <- factor(dat$PSA_test, ordered = FALSE)
dat$PSA_test <- relevel(dat$PSA_test, ref = "No")

dat$PSA_test_time_since <- as.numeric(dat$PSA_test_time_since)
dat$PSA_test_time_since[which(dat$PSA_test_time_since == "-10")] <- 0         
dat$PSA_test_time_since[which(dat$PSA_test_time_since == "-3")] <- NA         
dat$PSA_test_time_since[which(dat$PSA_test_time_since == "-1")] <- NA               


### dummy vars

## heart problem diagnosed by doctor

unique(dat$heart_diagnosis.0.0)

prefix <- "heart_diagnosis.0."
suffix <- seq(0,3)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]

# dummy var for heart attack
dat$heart_attack_diagnosis <- ifelse(rowSums(dat[f] == "Heart attack", na.rm = TRUE) > 0, 1, 
                                     ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$heart_attack_diagnosis)
dat$heart_attack_diagnosis <- recode_factor(dat$heart_attack_diagnosis,
                                            "0" = "No",
                                            "1" = "Yes")

# dummy var for stroke
dat$stroke_diagnosis <- ifelse(rowSums(dat[f] == "Stroke", na.rm = TRUE) > 0, 1, 
                               ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$stroke_diagnosis)
dat$stroke_diagnosis <- recode_factor(dat$stroke_diagnosis,
                                      "0" = "No",
                                      "1" = "Yes")

# dummy var for Angina
dat$angina_diagnosis <- ifelse(rowSums(dat[f] == "Angina", na.rm = TRUE) > 0, 1, 
                               ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$angina_diagnosis)
dat$angina_diagnosis <- recode_factor(dat$angina_diagnosis,
                                      "0" = "No",
                                      "1" = "Yes")

# dummy var for High blood pressure
dat$high_blood_pressure_diagnosis <- ifelse(rowSums(dat[f] == "High blood pressure", na.rm = TRUE) > 0, 1, 
                                            ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$high_blood_pressure_diagnosis)
dat$high_blood_pressure_diagnosis <- recode_factor(dat$high_blood_pressure_diagnosis,
                                                   "0" = "No",
                                                   "1" = "Yes")

## other problem diagnosed by doctor

unique(dat$other_diagnosis.0.0)

prefix <- "other_diagnosis.0."
suffix <- seq(0,4)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]

# dummy var for asthma
dat$asthma_diagnosis <- ifelse(rowSums(dat[f] == "Asthma", na.rm = TRUE) > 0, 1, 
                               ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$asthma_diagnosis)
dat$asthma_diagnosis <- recode_factor(dat$asthma_diagnosis,
                                      "0" = "No",
                                      "1" = "Yes")

# dummy var for Blood clot in the leg (DVT)
dat$DVT_diagnosis <- ifelse(rowSums(dat[f] == "Blood clot in the leg (DVT)", na.rm = TRUE) > 0, 1, 
                            ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$DVT_diagnosis)
dat$DVT_diagnosis <- recode_factor(dat$DVT_diagnosis,
                                   "0" = "No",
                                   "1" = "Yes")

# dummy var for Hayfever, allergic rhinitis or eczema
dat$hayfever_diagnosis <- ifelse(rowSums(dat[f] == "Hayfever, allergic rhinitis or eczema", na.rm = TRUE) > 0, 1, 
                                 ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$hayfever_diagnosis)
dat$hayfever_diagnosis <- recode_factor(dat$hayfever_diagnosis,
                                        "0" = "No",
                                        "1" = "Yes")

# dummy var for Emphysema/chronic bronchitis
dat$bronchitis_emphysema_diagnosis <- ifelse(rowSums(dat[f] == "Emphysema/chronic bronchitis", na.rm = TRUE) > 0, 1, 
                                             ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$bronchitis_emphysema_diagnosis)
dat$bronchitis_emphysema_diagnosis <- recode_factor(dat$bronchitis_emphysema_diagnosis,
                                                    "0" = "No",
                                                    "1" = "Yes")

# dummy var for Blood clot in the lung
dat$blood_clot_lung_diagnosis <- ifelse(rowSums(dat[f] == "Blood clot in the lung", na.rm = TRUE) > 0, 1, 
                                        ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$blood_clot_lung_diagnosis)
dat$blood_clot_lung_diagnosis <- recode_factor(dat$blood_clot_lung_diagnosis,
                                               "0" = "No",
                                               "1" = "Yes")

## fracture site

unique(dat$fracture_site.0.0)

prefix <- "fracture_site.0."
suffix <- seq(0,6)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]

# dummy var for Spine
dat$spine_fracture <- ifelse(rowSums(dat[f] == "Spine", na.rm = TRUE) > 0, 1, 
                             ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$spine_fracture)
dat$spine_fracture <- recode_factor(dat$spine_fracture,
                                    "0" = "No",
                                    "1" = "Yes")

# dummy var for Ankle
dat$ankle_fracture <- ifelse(rowSums(dat[f] == "Ankle", na.rm = TRUE) > 0, 1, 
                             ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$ankle_fracture)
dat$ankle_fracture <- recode_factor(dat$ankle_fracture,
                                    "0" = "No",
                                    "1" = "Yes")

# dummy var for Wrist
dat$wrist_fracture <- ifelse(rowSums(dat[f] == "Wrist", na.rm = TRUE) > 0, 1, 
                             ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$wrist_fracture)
dat$wrist_fracture <- recode_factor(dat$wrist_fracture,
                                    "0" = "No",
                                    "1" = "Yes")

# dummy var for Arm
dat$arm_fracture <- ifelse(rowSums(dat[f] == "Arm", na.rm = TRUE) > 0, 1, 
                           ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$arm_fracture)
dat$arm_fracture <- recode_factor(dat$arm_fracture,
                                  "0" = "No",
                                  "1" = "Yes")

# dummy var for Hip 
dat$hip_fracture <- ifelse(rowSums(dat[f] == "Hip", na.rm = TRUE) > 0, 1, 
                           ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$hip_fracture)
dat$hip_fracture <- recode_factor(dat$hip_fracture,
                                  "0" = "No",
                                  "1" = "Yes")

# dummy var for Leg 
dat$leg_fracture <- ifelse(rowSums(dat[f] == "Leg", na.rm = TRUE) > 0, 1, 
                           ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$leg_fracture)
dat$leg_fracture <- recode_factor(dat$leg_fracture,
                                  "0" = "No",
                                  "1" = "Yes")

# dummy var for Other bones 
dat$other_fracture <- ifelse(rowSums(dat[f] == "Other bones", na.rm = TRUE) > 0, 1, 
                             ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$other_fracture)
dat$other_fracture <- recode_factor(dat$other_fracture,
                                    "0" = "No",
                                    "1" = "Yes")

## glasses reason

unique(dat$glasses_reason.0.0)

prefix <- "glasses_reason.0."
suffix <- seq(0,5)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]

# dummy var for short sighted
dat$glasses_myopia <- ifelse(rowSums(dat[f] == "For short-sightedness, i.e. only or mainly for distance viewing such as driving, cinema etc (called 'myopia')", na.rm = TRUE) > 0, 1, 
                             ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$glasses_myopia)
dat$glasses_myopia <- recode_factor(dat$glasses_myopia,
                                    "0" = "No",
                                    "1" = "Yes")

# dummy var for short sighted
dat$glasses_presbyopia <- ifelse(rowSums(dat[f] == "For just reading/near work as you are getting older (called 'presbyopia')", na.rm = TRUE) > 0, 1, 
                                 ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$glasses_presbyopia)
dat$glasses_presbyopia <- recode_factor(dat$glasses_presbyopia,
                                        "0" = "No",
                                        "1" = "Yes")

# dummy var for long sighted
dat$glasses_hypermetropia <- ifelse(rowSums(dat[f] == "For long-sightedness, i.e. for distance and near, but particularly for near tasks like reading (called 'hypermetropia')", na.rm = TRUE) > 0, 1, 
                                    ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$glasses_hypermetropia)
dat$glasses_hypermetropia <- recode_factor(dat$glasses_hypermetropia,
                                           "0" = "No",
                                           "1" = "Yes")

# dummy var for lazy eye
dat$glasses_amblyopia <- ifelse(rowSums(dat[f] == "For a 'lazy' eye or an eye with poor vision since childhood (called 'amblyopia')", na.rm = TRUE) > 0, 1, 
                                ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$glasses_amblyopia)
dat$glasses_amblyopia <- recode_factor(dat$glasses_amblyopia,
                                       "0" = "No",
                                       "1" = "Yes")

# dummy var for astigmatism
dat$glasses_astigmatism <- ifelse(rowSums(dat[f] == "For 'astigmatism'", na.rm = TRUE) > 0, 1, 
                                  ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$glasses_astigmatism)
dat$glasses_astigmatism <- recode_factor(dat$glasses_astigmatism,
                                         "0" = "No",
                                         "1" = "Yes")

# dummy var for strabismus
dat$glasses_strabismus <- ifelse(rowSums(dat[f] == "For a 'squint' or 'turn' in an eye since childhood (called 'strabismus')", na.rm = TRUE) > 0, 1, 
                                 ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$glasses_strabismus)
dat$glasses_strabismus <- recode_factor(dat$glasses_strabismus,
                                        "0" = "No",
                                        "1" = "Yes")

# dummy var for other
dat$glasses_other <- ifelse(rowSums(dat[f] == "Other eye condition", na.rm = TRUE) > 0, 1, 
                            ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$glasses_other)
dat$glasses_other <- recode_factor(dat$glasses_other,
                                   "0" = "No",
                                   "1" = "Yes")


## eye disorders

unique(dat$eye_disorders.0.0)

prefix <- "eye_disorders.0."
suffix <- seq(0,4)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]

# dummy var for Glaucoma 
dat$glaucoma <- ifelse(rowSums(dat[f] == "Glaucoma ", na.rm = TRUE) > 0, 1, 
                       ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$glaucoma)
dat$glaucoma <- recode_factor(dat$glaucoma,
                              "0" = "No",
                              "1" = "Yes")

# dummy var for Glaucoma 
dat$macular_degeneration <- ifelse(rowSums(dat[f] == "Macular degeneration", na.rm = TRUE) > 0, 1, 
                                   ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$macular_degeneration)
dat$macular_degeneration <- recode_factor(dat$macular_degeneration,
                                          "0" = "No",
                                          "1" = "Yes")

# dummy var for Diabetes related eye disease
dat$diabetes_eye <- ifelse(rowSums(dat[f] == "Diabetes related eye disease", na.rm = TRUE) > 0, 1, 
                           ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$diabetes_eye)
dat$diabetes_eye <- recode_factor(dat$diabetes_eye,
                                  "0" = "No",
                                  "1" = "Yes")

# dummy var for Cataract 
dat$cataract <- ifelse(rowSums(dat[f] == "Cataract", na.rm = TRUE) > 0, 1, 
                       ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$cataract)
dat$cataract <- recode_factor(dat$cataract,
                              "0" = "No",
                              "1" = "Yes")

# dummy var for Other serious eye condition 
dat$other_serious_eye_condition <- ifelse(rowSums(dat[f] == "Other serious eye condition", na.rm = TRUE) > 0, 1, 
                                          ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$other_serious_eye_condition)
dat$other_serious_eye_condition <- recode_factor(dat$other_serious_eye_condition,
                                                 "0" = "No",
                                                 "1" = "Yes")

# dummy var for Injury or trauma resulting in loss of vision 
dat$trauma_vision_loss <- ifelse(rowSums(dat[f] == "Injury or trauma resulting in loss of vision", na.rm = TRUE) > 0, 1, 
                                 ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$trauma_vision_loss)
dat$trauma_vision_loss <- recode_factor(dat$trauma_vision_loss,
                                        "0" = "No",
                                        "1" = "Yes")

## mouth problems
unique(dat$mouth_problems.0.0)

prefix <- "mouth_problems.0."
suffix <- seq(0,5)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]

# dummy var for Bleeding gums
dat$bleeding_gums <- ifelse(rowSums(dat[f] == "Bleeding gums", na.rm = TRUE) > 0, 1, 
                            ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$bleeding_gums)
dat$bleeding_gums <- recode_factor(dat$bleeding_gums,
                                   "0" = "No",
                                   "1" = "Yes")

# dummy var for Dentures
dat$dentures <- ifelse(rowSums(dat[f] == "Dentures", na.rm = TRUE) > 0, 1, 
                       ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$dentures)
dat$dentures <- recode_factor(dat$dentures,
                              "0" = "No",
                              "1" = "Yes")

# dummy var for Toothache
dat$toothache <- ifelse(rowSums(dat[f] == "Toothache", na.rm = TRUE) > 0, 1, 
                        ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$toothache)
dat$toothache <- recode_factor(dat$toothache,
                               "0" = "No",
                               "1" = "Yes")

# dummy var for Mouth ulcers
dat$mouth_ulcers <- ifelse(rowSums(dat[f] == "Mouth ulcers", na.rm = TRUE) > 0, 1, 
                           ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$mouth_ulcers)
dat$mouth_ulcers <- recode_factor(dat$mouth_ulcers,
                                  "0" = "No",
                                  "1" = "Yes")

# dummy var for Painful gums
dat$painful_gums <- ifelse(rowSums(dat[f] == "Painful gums", na.rm = TRUE) > 0, 1, 
                           ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$painful_gums)
dat$painful_gums <- recode_factor(dat$painful_gums,
                                  "0" = "No",
                                  "1" = "Yes")

# dummy var for Loose teeth
dat$loose_teeth <- ifelse(rowSums(dat[f] == "Loose teeth", na.rm = TRUE) > 0, 1, 
                          ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$loose_teeth)
dat$loose_teeth <- recode_factor(dat$loose_teeth,
                                 "0" = "No",
                                 "1" = "Yes")

## pain last month
unique(dat$pain_last_1month.0.0)

prefix <- "pain_last_1month.0."
suffix <- seq(0,6)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]


# dummy var for Neck or shoulder pain
dat$neck_pain_1month <- ifelse(rowSums(dat[f] == "Neck or shoulder pain", na.rm = TRUE) > 0, 1, 
                            ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$neck_pain_1month)
dat$neck_pain_1month <- recode_factor(dat$neck_pain_1month,
                                   "0" = "No",
                                   "1" = "Yes")

# dummy var for Pain all over the body
dat$whole_body_pain_1month <- ifelse(rowSums(dat[f] == "Pain all over the body", na.rm = TRUE) > 0, 1, 
                            ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$whole_body_pain_1month)
dat$whole_body_pain_1month <- recode_factor(dat$whole_body_pain_1month,
                                   "0" = "No",
                                   "1" = "Yes")

# dummy var for Headache
dat$headaches_1month <- ifelse(rowSums(dat[f] == "Headache", na.rm = TRUE) > 0, 1, 
                            ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$headaches_1month)
dat$headaches_1month <- recode_factor(dat$headaches_1month,
                                   "0" = "No",
                                   "1" = "Yes")

# dummy var for Knee pain 
dat$knee_pain_1month <- ifelse(rowSums(dat[f] == "Knee pain", na.rm = TRUE) > 0, 1, 
                            ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$knee_pain_1month)
dat$knee_pain_1month <- recode_factor(dat$knee_pain_1month,
                                   "0" = "No",
                                   "1" = "Yes")

# dummy var for Stomach or abdominal pain 
dat$stomach_pain_1month <- ifelse(rowSums(dat[f] == "Stomach or abdominal pain", na.rm = TRUE) > 0, 1, 
                            ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$stomach_pain_1month)
dat$stomach_pain_1month <- recode_factor(dat$stomach_pain_1month,
                                   "0" = "No",
                                   "1" = "Yes")

# dummy var for Facial pain
dat$facial_pain_1month <- ifelse(rowSums(dat[f] == "Facial pain", na.rm = TRUE) > 0, 1, 
                            ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$facial_pain_1month)
dat$facial_pain_1month <- recode_factor(dat$facial_pain_1month,
                                   "0" = "No",
                                   "1" = "Yes")

# dummy var for Back pain
dat$back_pain_1month <- ifelse(rowSums(dat[f] == "Back pain", na.rm = TRUE) > 0, 1, 
                            ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$back_pain_1month)
dat$back_pain_1month <- recode_factor(dat$back_pain_1month,
                                   "0" = "No",
                                   "1" = "Yes")

# dummy var for Hip pain
dat$hip_pain_1month <- ifelse(rowSums(dat[f] == "Hip pain", na.rm = TRUE) > 0, 1, 
                            ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$hip_pain_1month)
dat$hip_pain_1month <- recode_factor(dat$hip_pain_1month,
                                   "0" = "No",
                                   "1" = "Yes")


#remove columns used to make dummy vars
dat <- subset(dat, select = -c(heart_diagnosis.0.0,
                               heart_diagnosis.0.1,
                               heart_diagnosis.0.2,
                               heart_diagnosis.0.3,
                               other_diagnosis.0.0,
                               other_diagnosis.0.1,
                               other_diagnosis.0.2,
                               other_diagnosis.0.3,
                               other_diagnosis.0.4,
                               fracture_site.0.0,
                               fracture_site.0.1,
                               fracture_site.0.2,
                               fracture_site.0.3,
                               fracture_site.0.4,
                               fracture_site.0.5,
                               fracture_site.0.6,
                               glasses_reason.0.0,
                               glasses_reason.0.1,
                               glasses_reason.0.2,
                               glasses_reason.0.3,
                               glasses_reason.0.4,
                               glasses_reason.0.5,
                               eye_disorders.0.0,
                               eye_disorders.0.1,
                               eye_disorders.0.2,
                               eye_disorders.0.3,
                               eye_disorders.0.4,
                               mouth_problems.0.0,
                               mouth_problems.0.1,
                               mouth_problems.0.2,
                               mouth_problems.0.3,
                               mouth_problems.0.4,
                               mouth_problems.0.5,
                               pain_last_1month.0.0,
                               pain_last_1month.0.1,
                               pain_last_1month.0.2,
                               pain_last_1month.0.3,
                               pain_last_1month.0.4,
                               pain_last_1month.0.5,
                               pain_last_1month.0.6))
```
<br /> 

### Medications
```{r medications, results='hide'}

unique(dat$other_meds)
sort(unique(dat$number_medications))


# convert to factors / numeric
# make unordered
# set reference category

dat$other_meds <- factor(dat$other_meds, ordered = FALSE)
dat$other_meds <- recode_factor(dat$other_meds, 
                                "No" = "No",
                                "Yes - you will be asked about this later by an interviewer" = "Yes")
dat$other_meds <- relevel(dat$other_meds, ref = "No")

dat$number_medications <- as.numeric(dat$number_medications)


### dummy variables 

## meds

unique(dat$meds.0.0)
                       
prefix <- "meds.0."
suffix <- seq(0,2)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]

# dummy var for Cholesterol lowering medication
dat$cholesterol_meds <- ifelse(rowSums(dat[f] == "Cholesterol lowering medication", na.rm = TRUE) > 0, 1, 
                               ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$cholesterol_meds)
dat$cholesterol_meds <- recode_factor(dat$cholesterol_meds,
                                      "0" = "No",
                                      "1" = "Yes")

# dummy var for Blood pressure medication
dat$blood_pressure_meds <- ifelse(rowSums(dat[f] == "Blood pressure medication", na.rm = TRUE) > 0, 1, 
                                  ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$blood_pressure_meds)
dat$blood_pressure_meds <- recode_factor(dat$blood_pressure_meds,
                                         "0" = "No",
                                         "1" = "Yes")

# dummy var for Insulin 
dat$insulin <- ifelse(rowSums(dat[f] == "Insulin", na.rm = TRUE) > 0, 1, 
                      ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$insulin)
dat$insulin <- recode_factor(dat$insulin,
                             "0" = "No",
                             "1" = "Yes")

## hormone medications

unique(dat$meds_hormones.0.0)

prefix <- "meds_hormones.0."
suffix <- seq(0,3)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]

# dummy var for Cholesterol lowering medication
dat$cholesterol_meds_v2 <- ifelse(rowSums(dat[f] == "Cholesterol lowering medication", na.rm = TRUE) > 0, 1, 
                                  ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$cholesterol_meds_v2)
dat$cholesterol_meds_v2 <- recode_factor(dat$cholesterol_meds_v2,
                                         "0" = "No",
                                         "1" = "Yes")

# dummy var for Blood pressure medication
dat$blood_pressure_meds_v2 <- ifelse(rowSums(dat[f] == "Blood pressure medication", na.rm = TRUE) > 0, 1, 
                                     ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$blood_pressure_meds_v2)
dat$blood_pressure_meds_v2 <- recode_factor(dat$blood_pressure_meds_v2,
                                            "0" = "No",
                                            "1" = "Yes")

# dummy var for Insulin 
dat$insulin_v2 <- ifelse(rowSums(dat[f] == "Insulin", na.rm = TRUE) > 0, 1, 
                         ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$insulin_v2)
dat$insulin_v2 <- recode_factor(dat$insulin_v2,
                                "0" = "No",
                                "1" = "Yes")

# pain medications

unique(dat$pain_meds.0.0)

prefix <- "pain_meds.0."
suffix <- seq(0,5)
f <- names(dat)[grep(paste0(paste0(prefix, suffix),collapse='|'),names(dat))]

# dummy var for Aspirin
dat$aspirin <- ifelse(rowSums(dat[f] == "Aspirin", na.rm = TRUE) > 0, 1, 
                      ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$aspirin)
dat$aspirin <- recode_factor(dat$aspirin,
                             "0" = "No",
                             "1" = "Yes")

# dummy var for Paracetamol
dat$paracetamol <- ifelse(rowSums(dat[f] == "Paracetamol", na.rm = TRUE) > 0, 1, 
                          ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$paracetamol)
dat$paracetamol <- recode_factor(dat$paracetamol,
                                 "0" = "No",
                                 "1" = "Yes")

# dummy var for Ibuprofen (e.g. Nurofen)
dat$ibuprofen <- ifelse(rowSums(dat[f] == "Ibuprofen (e.g. Nurofen)", na.rm = TRUE) > 0, 1, 
                        ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$ibuprofen)
dat$ibuprofen <- recode_factor(dat$ibuprofen,
                               "0" = "No",
                               "1" = "Yes")

# dummy var for Omeprazole (e.g. Zanprol)
dat$omeprazole <- ifelse(rowSums(dat[f] == "Omeprazole (e.g. Zanprol)", na.rm = TRUE) > 0, 1, 
                         ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$omeprazole)
dat$omeprazole <- recode_factor(dat$omeprazole,
                                "0" = "No",
                                "1" = "Yes")

# dummy var for Ranitidine (e.g. Zantac)
dat$ranitidine <- ifelse(rowSums(dat[f] == "Ranitidine (e.g. Zantac)", na.rm = TRUE) > 0, 1, 
                         ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$ranitidine)
dat$ranitidine <- recode_factor(dat$ranitidine,
                                "0" = "No",
                                "1" = "Yes")

# dummy var for Laxatives (e.g. Dulcolax, Senokot)
dat$laxatives <- ifelse(rowSums(dat[f] == "Laxatives (e.g. Dulcolax, Senokot)", na.rm = TRUE) > 0, 1, 
                        ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$laxatives)
dat$laxatives <- recode_factor(dat$laxatives,
                               "0" = "No",
                               "1" = "Yes")


## vitamins

unique(dat$vitamins.0.0)

prefix <- "vitamins.0."
suffix <- seq(0,6)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]

# dummy var for Multivitamins +/- minerals
dat$multivitamin_supplements <- ifelse(rowSums(dat[f] == "Multivitamins +/- minerals", na.rm = TRUE) > 0, 1, 
                                       ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$multivitamin_supplements)
dat$multivitamin_supplements <- recode_factor(dat$multivitamin_supplements,
                                              "0" = "No",
                                              "1" = "Yes")

# dummy var for Vitamin A
dat$vitamin_A_supplements <- ifelse(rowSums(dat[f] == "Vitamin A", na.rm = TRUE) > 0, 1, 
                                    ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$vitamin_A_supplements)
dat$vitamin_A_supplements <- recode_factor(dat$vitamin_A_supplements,
                                           "0" = "No",
                                           "1" = "Yes")

# dummy var for Vitamin B
dat$vitamin_B_supplements <- ifelse(rowSums(dat[f] == "Vitamin B", na.rm = TRUE) > 0, 1, 
                                    ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$vitamin_B_supplements)
dat$vitamin_B_supplements <- recode_factor(dat$vitamin_B_supplements,
                                           "0" = "No",
                                           "1" = "Yes")

# dummy var for Vitamin C
dat$vitamin_C_supplements <- ifelse(rowSums(dat[f] == "Vitamin C", na.rm = TRUE) > 0, 1, 
                                    ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$vitamin_C_supplements)
dat$vitamin_C_supplements <- recode_factor(dat$vitamin_C_supplements,
                                           "0" = "No",
                                           "1" = "Yes")

# dummy var for Vitamin D
dat$vitamin_D_supplements <- ifelse(rowSums(dat[f] == "Vitamin D", na.rm = TRUE) > 0, 1, 
                                    ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$vitamin_D_supplements)
dat$vitamin_D_supplements <- recode_factor(dat$vitamin_D_supplements,
                                           "0" = "No",
                                           "1" = "Yes")

# dummy var for Vitamin E
dat$vitamin_E_supplements <- ifelse(rowSums(dat[f] == "Vitamin E", na.rm = TRUE) > 0, 1, 
                                    ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$vitamin_E_supplements)
dat$vitamin_E_supplements <- recode_factor(dat$vitamin_E_supplements,
                                           "0" = "No",
                                           "1" = "Yes")

# dummy var for Folic acid or Folate (Vit B9)
dat$folate_supplements <- ifelse(rowSums(dat[f] == "Folic acid or Folate (Vit B9)", na.rm = TRUE) > 0, 1, 
                                 ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$folate_supplements)
dat$folate_supplements <- recode_factor(dat$folate_supplements,
                                        "0" = "No",
                                        "1" = "Yes")


## minerals

unique(dat$minerals.0.0)

prefix <- "minerals.0."
suffix <- seq(0,5)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]

# dummy var for Fish oil (including cod liver oil)
dat$fish_oil_supplements <- ifelse(rowSums(dat[f] == "Fish oil (including cod liver oil)", na.rm = TRUE) > 0, 1, 
                                       ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$fish_oil_supplements)
dat$fish_oil_supplements <- recode_factor(dat$fish_oil_supplements,
                                              "0" = "No",
                                              "1" = "Yes")

# dummy var for Calcium
dat$calcium_supplements <- ifelse(rowSums(dat[f] == "Calcium", na.rm = TRUE) > 0, 1, 
                                       ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$calcium_supplements)
dat$calcium_supplements <- recode_factor(dat$calcium_supplements,
                                              "0" = "No",
                                              "1" = "Yes")

# dummy var for Selenium
dat$selenium_supplements <- ifelse(rowSums(dat[f] == "Selenium", na.rm = TRUE) > 0, 1, 
                                       ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$selenium_supplements)
dat$selenium_supplements <- recode_factor(dat$selenium_supplements,
                                              "0" = "No",
                                              "1" = "Yes")

# dummy var for Glucosamine
dat$glucosamine_supplements <- ifelse(rowSums(dat[f] == "Glucosamine", na.rm = TRUE) > 0, 1, 
                                       ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$glucosamine_supplements)
dat$glucosamine_supplements <- recode_factor(dat$glucosamine_supplements,
                                              "0" = "No",
                                              "1" = "Yes")

# dummy var for Iron
dat$iron_supplements <- ifelse(rowSums(dat[f] == "Iron", na.rm = TRUE) > 0, 1, 
                                       ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$iron_supplements)
dat$iron_supplements <- recode_factor(dat$iron_supplements,
                                              "0" = "No",
                                              "1" = "Yes")

# dummy var for Zinc
dat$zinc_supplements <- ifelse(rowSums(dat[f] == "Zinc", na.rm = TRUE) > 0, 1, 
                                       ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$zinc_supplements)
dat$zinc_supplements <- recode_factor(dat$zinc_supplements,
                                              "0" = "No",
                                              "1" = "Yes")


#remove columns used to make dummy vars
dat <- subset(dat, select = -c(meds.0.0,
                               meds.0.1,
                               meds.0.2,
                               meds_hormones.0.0,
                               meds_hormones.0.1,
                               meds_hormones.0.2,
                               meds_hormones.0.3,
                               pain_meds.0.0,
                               pain_meds.0.1,
                               pain_meds.0.2,
                               pain_meds.0.3,
                               pain_meds.0.4,
                               pain_meds.0.5,
                               vitamins.0.0,
                               vitamins.0.1,
                               vitamins.0.2,
                               vitamins.0.3,
                               vitamins.0.4,
                               vitamins.0.5,
                               vitamins.0.6,
                               minerals.0.0,
                               minerals.0.1,
                               minerals.0.2,
                               minerals.0.3,
                               minerals.0.4,
                               minerals.0.5))
                      
                      
```
<br />  

### Male reproduction
```{r male_repro, results='hide'}

unique(dat$age_facial_hair)
unique(dat$age_voice)
unique(dat$balding)
sort(unique(dat$number_children))


# convert to factors / numeric
# make unordered
# set reference category

table(dat$age_facial_hair) # check to see the most common response to set as the ref level
dat$age_facial_hair <- factor(dat$age_facial_hair, ordered = FALSE)
dat$age_facial_hair <- relevel(dat$age_facial_hair, ref = "About average age")

table(dat$age_voice) # check to see the most common response to set as the ref level
dat$age_voice <- factor(dat$age_voice, ordered = FALSE)
dat$age_voice <- relevel(dat$age_voice, ref = "About average age")

table(dat$balding) # check to see the most common response to set as the ref level
dat$balding <- factor(dat$balding, ordered = FALSE)
dat$balding <- relevel(dat$balding, ref = "Pattern 1")

dat$number_children <- as.numeric(dat$number_children)
dat$number_children[which(dat$number_children == "-3")] <- NA         
dat$number_children[which(dat$number_children == "-1")] <- NA   

```
<br />   

### Female reproduction
```{r female_repro, results='hide'}

unique(dat$mammogram)
sort(unique(dat$mammogram_years_since))
unique(dat$cervical_smear)
sort(unique(dat$cervical_smear_years_since))
sort(unique(dat$menarche_age))
unique(dat$menopause)
sort(unique(dat$period_time_since))
sort(unique(dat$menstrual_cycle_length))
unique(dat$menstruating_today)
sort(unique(dat$number_births))
sort(unique(dat$first_child_birth_weight))
sort(unique(dat$birth_age))
sort(unique(dat$first_birth_age))
sort(unique(dat$last_birth_age))
unique(dat$stillbirth)
sort(unique(dat$number_stillbirths))
sort(unique(dat$number_miscarriages))
sort(unique(dat$number_terminations))
unique(dat$oral_contraceptive)
sort(unique(dat$oral_contraceptive_age_first))
sort(unique(dat$oral_contraceptive_age_last))
unique(dat$HRT)
sort(unique(dat$HRT_age_first))
sort(unique(dat$HRT_age_last))
unique(dat$hysterectomy)
sort(unique(dat$hysterectomy_age))
unique(dat$bilateral_oophorectomy)
sort(unique(dat$bilateral_oophorectomy_age))
unique(dat$pregnant)

# convert to factors / numeric
# make unordered
# set reference category

dat$mammogram <- factor(dat$mammogram, ordered = FALSE)
dat$mammogram <- relevel(dat$mammogram, ref = "No")

dat$mammogram_years_since <- as.numeric(dat$mammogram_years_since)
dat$mammogram_years_since[which(dat$mammogram_years_since == "-10")] <- 0.5      
dat$mammogram_years_since[which(dat$mammogram_years_since == "-3")] <- NA         
dat$mammogram_years_since[which(dat$mammogram_years_since == "-1")] <- NA  

dat$cervical_smear <- factor(dat$cervical_smear, ordered = FALSE)
dat$cervical_smear <- relevel(dat$cervical_smear, ref = "No")

dat$cervical_smear_years_since <- as.numeric(dat$cervical_smear_years_since)
dat$cervical_smear_years_since[which(dat$cervical_smear_years_since == "-10")] <- 0.5      
dat$cervical_smear_years_since[which(dat$cervical_smear_years_since == "-3")] <- NA         
dat$cervical_smear_years_since[which(dat$cervical_smear_years_since == "-1")] <- NA   

dat$menarche_age <- as.numeric(dat$menarche_age)
dat$menarche_age[which(dat$menarche_age == "-3")] <- NA         
dat$menarche_age[which(dat$menarche_age == "-1")] <- NA 

dat$menopause[which(dat$menopause == "Not sure - had a hysterectomy")] <- NA         
dat$menopause[which(dat$menopause == "Not sure - other reason")] <- NA  
dat$menopause <- factor(dat$menopause, ordered = FALSE)
dat$menopause <- relevel(dat$menopause, ref = "No")

dat$period_time_since <- as.numeric(dat$period_time_since)
dat$period_time_since[which(dat$period_time_since == "-3")] <- NA         
dat$period_time_since[which(dat$period_time_since == "-1")] <- NA 

dat$menstrual_cycle_length <- as.numeric(dat$menstrual_cycle_length)
dat$menstrual_cycle_length[which(dat$menstrual_cycle_length == "-6")] <- NA      
dat$menstrual_cycle_length[which(dat$menstrual_cycle_length == "-3")] <- NA         
dat$menstrual_cycle_length[which(dat$menstrual_cycle_length == "-1")] <- NA 

dat$menstruating_today <- factor(dat$menstruating_today, ordered = FALSE)
dat$menstruating_today <- relevel(dat$menstruating_today, ref = "No")

dat$number_births <- as.numeric(dat$number_births)
dat$number_births[which(dat$number_births == "-3")] <- NA         

dat$first_child_birth_weight <- as.numeric(dat$first_child_birth_weight)
dat$first_child_birth_weight[which(dat$first_child_birth_weight == "-3")] <- NA      
dat$first_child_birth_weight[which(dat$first_child_birth_weight == "-2")] <- NA         
dat$first_child_birth_weight[which(dat$first_child_birth_weight == "-1")] <- NA 

dat$birth_age <- as.numeric(dat$birth_age)
dat$birth_age[which(dat$birth_age == "-4")] <- NA      
dat$birth_age[which(dat$birth_age == "-3")] <- NA 

dat$first_birth_age <- as.numeric(dat$first_birth_age)
dat$first_birth_age[which(dat$first_birth_age == "-4")] <- NA      
dat$first_birth_age[which(dat$first_birth_age == "-3")] <- NA 

dat$last_birth_age <- as.numeric(dat$last_birth_age)
dat$last_birth_age[which(dat$last_birth_age == "-4")] <- NA      
dat$last_birth_age[which(dat$last_birth_age == "-3")] <- NA 

dat$stillbirth <- factor(dat$stillbirth, ordered = FALSE)
dat$stillbirth <- relevel(dat$stillbirth, ref = "No")

dat$number_stillbirths <- as.numeric(dat$number_stillbirths)
dat$number_stillbirths[which(dat$number_stillbirths == "-3")] <- NA         
dat$number_stillbirths[which(dat$number_stillbirths == "-1")] <- NA 

dat$number_miscarriages <- as.numeric(dat$number_miscarriages)
dat$number_miscarriages[which(dat$number_miscarriages == "-3")] <- NA         
dat$number_miscarriages[which(dat$number_miscarriages == "-1")] <- NA 

dat$number_pregnancy_terminations <- as.numeric(dat$number_pregnancy_terminations)
dat$number_pregnancy_terminations[which(dat$number_pregnancy_terminations == "-3")] <- NA         
dat$number_pregnancy_terminations[which(dat$number_pregnancy_terminations == "-1")] <- NA 

dat$oral_contraceptive <- factor(dat$oral_contraceptive, ordered = FALSE)
dat$oral_contraceptive <- relevel(dat$oral_contraceptive, ref = "No")

dat$oral_contraceptive_age_first <- as.numeric(dat$oral_contraceptive_age_first)
dat$oral_contraceptive_age_first[which(dat$oral_contraceptive_age_first == "-3")] <- NA         
dat$oral_contraceptive_age_first[which(dat$oral_contraceptive_age_first == "-1")] <- NA 

dat$oral_contraceptive_age_last <- as.numeric(dat$oral_contraceptive_age_last)
dat$oral_contraceptive_age_last[which(dat$oral_contraceptive_age_last == "-11")] <- NA         
dat$oral_contraceptive_age_last[which(dat$oral_contraceptive_age_last == "-3")] <- NA         
dat$oral_contraceptive_age_last[which(dat$oral_contraceptive_age_last == "-1")] <- NA 

dat$HRT <- factor(dat$HRT, ordered = FALSE)
dat$HRT <- relevel(dat$HRT, ref = "No")

dat$HRT_age_first <- as.numeric(dat$HRT_age_first)
dat$HRT_age_first[which(dat$HRT_age_first == "-3")] <- NA         
dat$HRT_age_first[which(dat$HRT_age_first == "-1")] <- NA 

dat$HRT_age_last <- as.numeric(dat$HRT_age_last)
dat$HRT_age_last[which(dat$HRT_age_last == "-11")] <- NA         
dat$HRT_age_last[which(dat$HRT_age_last == "-3")] <- NA         
dat$HRT_age_last[which(dat$HRT_age_last == "-1")] <- NA 

dat$hysterectomy[which(dat$hysterectomy == "Not sure")] <- NA  
dat$hysterectomy <- factor(dat$hysterectomy, ordered = FALSE)
dat$hysterectomy <- relevel(dat$hysterectomy, ref = "No")

dat$hysterectomy_age <- as.numeric(dat$hysterectomy_age)
dat$hysterectomy_age[which(dat$hysterectomy_age == "-3")] <- NA         
dat$hysterectomy_age[which(dat$hysterectomy_age == "-1")] <- NA 

dat$bilateral_oophorectomy[which(dat$bilateral_oophorectomy == "Not sure")] <- NA  
dat$bilateral_oophorectomy <- factor(dat$bilateral_oophorectomy, ordered = FALSE)
dat$bilateral_oophorectomy <- relevel(dat$bilateral_oophorectomy, ref = "No")

dat$bilateral_oophorectomy_age <- as.numeric(dat$bilateral_oophorectomy_age)
dat$bilateral_oophorectomy_age[which(dat$bilateral_oophorectomy_age == "-3")] <- NA         
dat$bilateral_oophorectomy_age[which(dat$bilateral_oophorectomy_age == "-1")] <- NA 

dat$pregnant[which(dat$pregnant == "Unsure")] <- NA  
dat$pregnant <- factor(dat$pregnant, ordered = FALSE)
dat$pregnant <- relevel(dat$pregnant, ref = "No")
```
<br />   

### Mental health
```{r mental_health, results='hide'}

unique(dat$bipolar_MDD)
sort(unique(dat$neuroticism))
unique(dat$mood_swings)
unique(dat$miserableness)
unique(dat$irritability)
unique(dat$sensitivity)
unique(dat$fed_up_feelings)
unique(dat$nervous)
unique(dat$worrier)
unique(dat$tense)
unique(dat$worry_embarassment)
unique(dat$nerves)
unique(dat$guilty_feelings)
unique(dat$risk_taking)
unique(dat$depressed_mood_freq)
unique(dat$unenthusiasm_freq)
unique(dat$tenseness_freq)
unique(dat$tiredness_freq)
unique(dat$doctor_visit_mental_health)
unique(dat$psychiatrist_visit_mental_health)
unique(dat$depressed_whole_week)
sort(unique(dat$depression_duration))
sort(unique(dat$depression_episodes))
unique(dat$unenthusiastic_whole_week)
sort(unique(dat$unenthusiastic_duration))
sort(unique(dat$unenthusiastic_episodes))
unique(dat$manic)
unique(dat$irritable)
unique(dat$manic_duration)
unique(dat$manic_episodes)

# convert to factors / numeric
# make unordered
# set reference category

dat$bipolar_MDD <- factor(dat$bipolar_MDD, ordered = FALSE)
dat$bipolar_MDD <- relevel(dat$bipolar_MDD, ref = "No Bipolar or Depression")

dat$neuroticism <- as.numeric(dat$neuroticism)

dat$mood_swings <- factor(dat$mood_swings, ordered = FALSE)
dat$mood_swings <- relevel(dat$mood_swings, ref = "No")

dat$miserableness <- factor(dat$miserableness, ordered = FALSE)
dat$miserableness <- relevel(dat$miserableness, ref = "No")

dat$irritability <- factor(dat$irritability, ordered = FALSE)
dat$irritability <- relevel(dat$irritability, ref = "No")

dat$sensitivity <- factor(dat$sensitivity, ordered = FALSE)
dat$sensitivity <- relevel(dat$sensitivity, ref = "No")

dat$fed_up_feelings <- factor(dat$fed_up_feelings, ordered = FALSE)
dat$fed_up_feelings <- relevel(dat$fed_up_feelings, ref = "No")

dat$nervous <- factor(dat$nervous, ordered = FALSE)
dat$nervous <- relevel(dat$nervous, ref = "No")

dat$worrier <- factor(dat$worrier, ordered = FALSE)
dat$worrier <- relevel(dat$worrier, ref = "No")

dat$tense <- factor(dat$tense, ordered = FALSE)
dat$tense <- relevel(dat$tense, ref = "No")

dat$worry_embarassment <- factor(dat$worry_embarassment, ordered = FALSE)
dat$worry_embarassment <- relevel(dat$worry_embarassment, ref = "No")

dat$nerves <- factor(dat$nerves, ordered = FALSE)
dat$nerves <- relevel(dat$nerves, ref = "No")

dat$guilty_feelings <- factor(dat$guilty_feelings, ordered = FALSE)
dat$guilty_feelings <- relevel(dat$guilty_feelings, ref = "No")

dat$risk_taking <- factor(dat$risk_taking, ordered = FALSE)
dat$risk_taking <- relevel(dat$risk_taking, ref = "No")

dat$depressed_mood_freq <- factor(dat$depressed_mood_freq, ordered = FALSE)
dat$depressed_mood_freq <- relevel(dat$depressed_mood_freq, ref = "Not at all")

dat$unenthusiasm_freq <- factor(dat$unenthusiasm_freq, ordered = FALSE)
dat$unenthusiasm_freq <- relevel(dat$unenthusiasm_freq, ref = "Not at all")

dat$tenseness_freq <- factor(dat$tenseness_freq, ordered = FALSE)
dat$tenseness_freq <- relevel(dat$tenseness_freq, ref = "Not at all")

dat$tiredness_freq <- factor(dat$tiredness_freq, ordered = FALSE)
dat$tiredness_freq <- relevel(dat$tiredness_freq, ref = "Not at all")

dat$doctor_visit_mental_health <- factor(dat$doctor_visit_mental_health, ordered = FALSE)
dat$doctor_visit_mental_health <- relevel(dat$doctor_visit_mental_health, ref = "No")

dat$psychiatrist_visit_mental_health <- factor(dat$psychiatrist_visit_mental_health, ordered = FALSE)
dat$psychiatrist_visit_mental_health <- relevel(dat$psychiatrist_visit_mental_health, ref = "No")

dat$depressed_whole_week <- factor(dat$depressed_whole_week, ordered = FALSE)
dat$depressed_whole_week <- relevel(dat$depressed_whole_week, ref = "No")

dat$depression_duration <- as.numeric(dat$depression_duration)
dat$depression_episodes[which(dat$depression_episodes == "-3")] <- NA         
dat$depression_duration[which(dat$depression_duration == "-1")] <- NA 

dat$depression_episodes <- as.numeric(dat$depression_episodes)
dat$depression_episodes[which(dat$depression_episodes == "-3")] <- NA         
dat$depression_episodes[which(dat$depression_episodes == "-1")] <- NA 

dat$unenthusiastic_whole_week <- factor(dat$unenthusiastic_whole_week, ordered = FALSE)
dat$unenthusiastic_whole_week <- relevel(dat$unenthusiastic_whole_week, ref = "No")

dat$unenthusiastic_duration <- as.numeric(dat$unenthusiastic_duration)
dat$unenthusiastic_duration[which(dat$unenthusiastic_duration == "-3")] <- NA         
dat$unenthusiastic_duration[which(dat$unenthusiastic_duration == "-1")] <- NA 

dat$unenthusiastic_episodes <- as.numeric(dat$unenthusiastic_episodes)
dat$unenthusiastic_episodes[which(dat$unenthusiastic_episodes == "-3")] <- NA         
dat$unenthusiastic_episodes[which(dat$unenthusiastic_episodes == "-1")] <- NA 

dat$manic <- factor(dat$manic, ordered = FALSE)
dat$manic <- relevel(dat$manic, ref = "No")

dat$irritable <- factor(dat$irritable, ordered = FALSE)
dat$irritable <- relevel(dat$irritable, ref = "No")

dat$manic_duration <- factor(dat$manic_duration, levels = c("Less than a week",
                                                            "At least two days, but less than a week",
                                                            "A week or more"), ordered = FALSE)
dat$manic_duration <- relevel(dat$manic_duration, ref = "Less than a week")

dat$manic_episodes <- factor(dat$manic_episodes, levels = c("No problems",
                                                            "Needed treatment or caused problems with work, relationships, finances, the law or other aspects of life"), ordered = FALSE)
dat$manic_episodes <- relevel(dat$manic_episodes, ref = "No problems")


### dummy variables

unique(dat$manic_symptoms.0.0)

prefix <- "manic_symptoms.0."
suffix <- seq(0,3)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]

# dummy var for more creative
dat$manic_symptoms_creative <- ifelse(rowSums(dat[f] == "I was more creative or had more ideas than usual", na.rm = TRUE) > 0, 1, 
                                      ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$manic_symptoms_creative)
dat$manic_symptoms_creative <- recode_factor(dat$manic_symptoms_creative,
                                             "0" = "No",
                                             "1" = "Yes")

# dummy var for more active
dat$manic_symptoms_active <- ifelse(rowSums(dat[f] == "I was more active than usual", na.rm = TRUE) > 0, 1, 
                                    ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$manic_symptoms_active)
dat$manic_symptoms_active <- recode_factor(dat$manic_symptoms_active,
                                           "0" = "No",
                                           "1" = "Yes")

# dummy var for I needed less sleep than usual
dat$manic_symptoms_less_sleep <- ifelse(rowSums(dat[f] == "I needed less sleep than usual", na.rm = TRUE) > 0, 1, 
                                        ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$manic_symptoms_less_sleep)
dat$manic_symptoms_less_sleep <- recode_factor(dat$manic_symptoms_less_sleep,
                                               "0" = "No",
                                               "1" = "Yes")

# dummy var for I was more talkative than usual
dat$manic_symptoms_talkative <- ifelse(rowSums(dat[f] == "I was more talkative than usual", na.rm = TRUE) > 0, 1, 
                                       ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$manic_symptoms_talkative)
dat$manic_symptoms_talkative <- recode_factor(dat$manic_symptoms_talkative,
                                              "0" = "No",
                                              "1" = "Yes")

# dummy var for All of the above
dat$manic_symptoms_all <- ifelse(rowSums(dat[f] == "All of the above", na.rm = TRUE) > 0, 1, 
                                 ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$manic_symptoms_all)
dat$manic_symptoms_all <- recode_factor(dat$manic_symptoms_all,
                                        "0" = "No",
                                        "1" = "Yes")


#remove excluded columns and those used to make dummy vars
dat <- subset(dat, select = -c(bipolar,
                               MDD_moderate,
                               MDD_severe,
                               MDD_single_ep, 
                               manic_symptoms.0.0,
                               manic_symptoms.0.1,
                               manic_symptoms.0.2,
                               manic_symptoms.0.3))

```
<br />   

### Electronics use
```{r electronics, results='hide'}

unique(dat$mobile_phone_duration)
unique(dat$mobile_phone_weekly_usage)
unique(dat$speakerphone)
unique(dat$mobile_phone_2yrs)
unique(dat$head_side_phone)
unique(dat$computer_games)

# convert to factors / numeric
# make unordered
# set reference category

dat$mobile_phone_duration <- factor(dat$mobile_phone_duration, ordered = FALSE)
dat$mobile_phone_duration <- relevel(dat$mobile_phone_duration, ref = "Never used mobile phone at least once per week")

dat$mobile_phone_weekly_usage <- factor(dat$mobile_phone_weekly_usage, ordered = FALSE)
dat$mobile_phone_weekly_usage <- relevel(dat$mobile_phone_weekly_usage, ref = "Less than 5mins")

dat$speakerphone <- factor(dat$speakerphone, ordered = FALSE)
dat$speakerphone <- relevel(dat$speakerphone, ref = "Never or almost never")

dat$mobile_phone_2yrs <- factor(dat$mobile_phone_2yrs, ordered = FALSE)
dat$mobile_phone_2yrs <- relevel(dat$mobile_phone_2yrs, ref = "No")

table(dat$head_side_phone)
dat$head_side_phone <- factor(dat$head_side_phone, ordered = FALSE)
dat$head_side_phone <- relevel(dat$head_side_phone, ref = "Right")

dat$computer_games <- factor(dat$computer_games, ordered = FALSE)
dat$computer_games <- relevel(dat$computer_games, ref = "Never/rarely")
```

### Sleep
```{r sleep, results='hide'}
sort(unique(dat$sleep_hours))
unique(dat$easy_wake)
unique(dat$chronotype)
unique(dat$nap)
unique(dat$sleep_difficulty)
unique(dat$snoring)
unique(dat$narcolepsy)


dat$sleep_hours <- as.numeric(dat$sleep_hours)
dat$sleep_hours[which(dat$sleep_hours == "-3")] <- NA         
dat$sleep_hours[which(dat$sleep_hours == "-1")] <- NA 


dat$easy_wake <- factor(dat$easy_wake, ordered = FALSE)
dat$easy_wake <- relevel(dat$easy_wake, ref = "Not at all easy")

table(dat$chronotype)
dat$chronotype <- factor(dat$chronotype, ordered = FALSE)
dat$chronotype <- relevel(dat$chronotype, ref = "More a 'morning' than 'evening' person")

dat$nap <- factor(dat$nap, ordered = FALSE)
dat$nap <- relevel(dat$nap, ref = "Never/rarely")

dat$sleep_difficulty <- factor(dat$sleep_difficulty, ordered = FALSE)
dat$sleep_difficulty <- relevel(dat$sleep_difficulty, ref = "Never/rarely")

dat$snoring <- factor(dat$snoring, ordered = FALSE)
dat$snoring <- relevel(dat$snoring, ref = "No")

dat$narcolepsy <- factor(dat$narcolepsy, ordered = FALSE)
dat$narcolepsy <- relevel(dat$narcolepsy, ref = "Never/rarely")
```
<br />   

### Smoking
```{r smoking, results='hide'}

unique(dat$ever_smoked)
sort(unique(dat$pack_years_prop))
sort(unique(dat$pack_years))
unique(dat$smoking_status)
unique(dat$tobacco)
unique(dat$past_tobacco)
unique(dat$light_smoking)
sort(unique(dat$smoking_start_age_current))
unique(dat$tobacco_type)
unique(dat$previous_smoker)
sort(unique(dat$number_cigarettes))
sort(unique(dat$cigarettes_stop_age))
sort(unique(dat$previous_number_cigarettes))
unique(dat$waking_smoke_time)
unique(dat$smoking_10yrs)
sort(unique(dat$smoking_start_age_former))
unique(dat$tobacco_type_previous)
sort(unique(dat$number_cigarettes_previous))
sort(unique(dat$smoking_stop_age))
unique(dat$ever_stop_smoking_6months)
sort(unique(dat$number_quit_attempts))
unique(dat$hshld_smokers)
sort(unique(dat$tobacco_exposure_home))
sort(unique(dat$tobacco_exposure_outside))


# convert to factors / numeric
# make unordered
# set reference category

dat$ever_smoked <- factor(dat$ever_smoked, ordered = FALSE)
dat$ever_smoked <- relevel(dat$ever_smoked, ref = "No")

dat$pack_years_prop <- as.numeric(dat$pack_years_prop)

dat$pack_years <- as.numeric(dat$pack_years)

dat$smoking_status <- factor(dat$smoking_status, ordered = FALSE)
dat$smoking_status <- relevel(dat$smoking_status, ref = "Never")

dat$tobacco <- factor(dat$tobacco, levels = c("No",
                                              "Only occasionally",
                                              "Yes, on most or all days"), ordered = FALSE)
dat$tobacco <- relevel(dat$tobacco, ref = "No")

dat$past_tobacco <- factor(dat$past_tobacco, levels = c("I have never smoked",
                                                        "Just tried once or twice",
                                                        "Smoked occasionally",
                                                        "Smoked on most or all days"), ordered = FALSE)
dat$past_tobacco <- relevel(dat$past_tobacco, ref = "I have never smoked")

dat$light_smoking <- factor(dat$light_smoking, ordered = FALSE)
dat$light_smoking <- relevel(dat$light_smoking, ref = "No")

dat$smoking_start_age_current <- as.numeric(dat$smoking_start_age_current)
dat$smoking_start_age_current[which(dat$smoking_start_age_current == "-3")] <- NA         
dat$smoking_start_age_current[which(dat$smoking_start_age_current == "-1")] <- NA 

table(dat$tobacco_type)
dat$tobacco_type <- factor(dat$tobacco_type, ordered = FALSE)
dat$tobacco_type <- relevel(dat$tobacco_type, ref = "Manufactured cigarettes")

dat$previous_smoker <- factor(dat$previous_smoker, ordered = FALSE)
dat$previous_smoker <- relevel(dat$previous_smoker, ref = "No")

dat$number_cigarettes <- as.numeric(dat$number_cigarettes)
dat$number_cigarettes[which(dat$number_cigarettes == "-10")] <- 0.5         
dat$number_cigarettes[which(dat$number_cigarettes == "-3")] <- NA         
dat$number_cigarettes[which(dat$number_cigarettes == "-1")] <- NA 

dat$cigarettes_stop_age <- as.numeric(dat$cigarettes_stop_age)
dat$cigarettes_stop_age[which(dat$cigarettes_stop_age == "-3")] <- NA         
dat$cigarettes_stop_age[which(dat$cigarettes_stop_age == "-1")] <- NA 

dat$previous_number_cigarettes <- as.numeric(dat$previous_number_cigarettes)
dat$previous_number_cigarettes[which(dat$previous_number_cigarettes == "-10")] <- 0.5         
dat$previous_number_cigarettes[which(dat$previous_number_cigarettes == "-1")] <- NA 

dat$waking_smoke_time <- factor(dat$waking_smoke_time, ordered = FALSE)
dat$waking_smoke_time <- relevel(dat$waking_smoke_time, ref = "Less than 5 minutes")

table(dat$smoking_10yrs)
dat$smoking_10yrs <- factor(dat$smoking_10yrs, ordered = FALSE)
dat$smoking_10yrs <- relevel(dat$smoking_10yrs, ref = "Less nowadays?")

dat$smoking_start_age_former <- as.numeric(dat$smoking_start_age_former)
dat$smoking_start_age_former[which(dat$smoking_start_age_former == "-3")] <- NA         
dat$smoking_start_age_former[which(dat$smoking_start_age_former == "-1")] <- NA 

table(dat$tobacco_type_previous)
dat$tobacco_type_previous <- factor(dat$tobacco_type_previous, ordered = FALSE)
dat$tobacco_type_previous <- relevel(dat$tobacco_type_previous, ref = "Manufactured cigarettes")

dat$number_cigarettes_previous <- as.numeric(dat$number_cigarettes_previous)
dat$number_cigarettes_previous[which(dat$number_cigarettes_previous == "-10")] <- 0.5         
dat$number_cigarettes_previous[which(dat$number_cigarettes_previous == "-1")] <- NA 

dat$smoking_stop_age <- as.numeric(dat$smoking_stop_age)
dat$smoking_stop_age[which(dat$smoking_stop_age == "-3")] <- NA         
dat$smoking_stop_age[which(dat$smoking_stop_age == "-1")] <- NA 

dat$ever_stop_smoking_6months <- factor(dat$ever_stop_smoking_6months, ordered = FALSE)
dat$ever_stop_smoking_6months <- relevel(dat$ever_stop_smoking_6months, ref = "No")

dat$number_quit_attempts <- as.numeric(dat$number_quit_attempts)
dat$number_quit_attempts[which(dat$number_quit_attempts == "-3")] <- NA         
dat$number_quit_attempts[which(dat$number_quit_attempts == "-1")] <- NA 

table(dat$hshld_smokers)
dat$hshld_smokers <- factor(dat$hshld_smokers, ordered = FALSE)
dat$hshld_smokers <- relevel(dat$hshld_smokers, ref = "No")

dat$tobacco_exposure_home <- as.numeric(dat$tobacco_exposure_home)
dat$tobacco_exposure_home[which(dat$tobacco_exposure_home == "-3")] <- NA         
dat$tobacco_exposure_home[which(dat$tobacco_exposure_home == "-1")] <- NA 

dat$tobacco_exposure_outside <- as.numeric(dat$tobacco_exposure_outside)
dat$tobacco_exposure_outside[which(dat$tobacco_exposure_outside == "-3")] <- NA         
dat$tobacco_exposure_outside[which(dat$tobacco_exposure_outside == "-1")] <- NA 


### dummy variables

## why reduced smoking

unique(dat$why_reduced_smoking.0.0)

prefix <- "why_reduced_smoking.0."
suffix <- seq(0,3)
f <- names(dat)[grep(paste0(paste0(prefix, suffix),collapse='|'),names(dat))]

# dummy var for health
dat$reduced_smoking_health <- ifelse(rowSums(dat[f] == "Health precaution", na.rm = TRUE) > 0, 1, 
                                     ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$reduced_smoking_health)
dat$reduced_smoking_health <- recode_factor(dat$reduced_smoking_health,
                                            "0" = "No",
                                            "1" = "Yes")

# dummy var for Illness or ill health
dat$reduced_smoking_illness <- ifelse(rowSums(dat[f] == "Illness or ill health", na.rm = TRUE) > 0, 1, 
                                      ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$reduced_smoking_illness)
dat$reduced_smoking_illness <- recode_factor(dat$reduced_smoking_illness,
                                             "0" = "No",
                                             "1" = "Yes")

# dummy var for Illness or Financial reasons
dat$reduced_smoking_financial <- ifelse(rowSums(dat[f] == "Financial reasons", na.rm = TRUE) > 0, 1, 
                                        ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$reduced_smoking_financial)
dat$reduced_smoking_financial <- recode_factor(dat$reduced_smoking_financial,
                                               "0" = "No",
                                               "1" = "Yes")

# dummy var for Illness or Doctor's advice
dat$reduced_smoking_doctor <- ifelse(rowSums(dat[f] == "Doctor's advice", na.rm = TRUE) > 0, 1, 
                                     ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$reduced_smoking_doctor)
dat$reduced_smoking_doctor <- recode_factor(dat$reduced_smoking_doctor,
                                            "0" = "No",
                                            "1" = "Yes")


## why stopped smoking

unique(dat$why_stopped_smoking.0.0)

prefix <- "why_stopped_smoking.0."
suffix <- seq(0,3)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]


# dummy var for health
dat$stopped_smoking_health <- ifelse(rowSums(dat[f] == "Health precaution", na.rm = TRUE) > 0, 1, 
                                     ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$stopped_smoking_health)
dat$stopped_smoking_health <- recode_factor(dat$stopped_smoking_health,
                                            "0" = "No",
                                            "1" = "Yes")

# dummy var for Illness or ill health
dat$stopped_smoking_illness <- ifelse(rowSums(dat[f] == "Illness or ill health", na.rm = TRUE) > 0, 1, 
                                      ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$stopped_smoking_illness)
dat$stopped_smoking_illness <- recode_factor(dat$stopped_smoking_illness,
                                             "0" = "No",
                                             "1" = "Yes")

# dummy var for Illness or Financial reasons
dat$stopped_smoking_financial <- ifelse(rowSums(dat[f] == "Financial reasons", na.rm = TRUE) > 0, 1, 
                                        ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$stopped_smoking_financial)
dat$stopped_smoking_financial <- recode_factor(dat$stopped_smoking_financial,
                                               "0" = "No",
                                               "1" = "Yes")

# dummy var for Illness or Doctor's advice
dat$stopped_smoking_doctor <- ifelse(rowSums(dat[f] == "Doctor's advice", na.rm = TRUE) > 0, 1, 
                                     ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$stopped_smoking_doctor)
dat$stopped_smoking_doctor <- recode_factor(dat$stopped_smoking_doctor,
                                            "0" = "No",
                                            "1" = "Yes")


#remove columns used to make dummy vars
dat <- subset(dat, select = -c(why_reduced_smoking.0.0,
                               why_reduced_smoking.0.1,
                               why_reduced_smoking.0.2,
                               why_reduced_smoking.0.3,
                               why_stopped_smoking.0.0,
                               why_stopped_smoking.0.1,
                               why_stopped_smoking.0.2,
                               why_stopped_smoking.0.3))

```
<br />   

### Alcohol
```{r alcohol, results='hide'}

unique(dat$alcohol_status)
unique(dat$alcohol_freq)
unique(dat$alcohol_former)
sort(unique(dat$red_wine_monthly))
sort(unique(dat$white_wine_monthly))
sort(unique(dat$beer_monthly))
sort(unique(dat$spirits_monthly))
sort(unique(dat$fortified_wine_monthly))
sort(unique(dat$other_alcohol_monthly))
sort(unique(dat$red_wine_weekly))
sort(unique(dat$white_wine_weekly))
sort(unique(dat$beer_weekly))
sort(unique(dat$spirits_weekly))
sort(unique(dat$fortified_wine_weekly))
sort(unique(dat$other_alcohol_weekly))
unique(dat$alcohol_with_meals)
unique(dat$alcohol_10yrs)
unique(dat$reason_reducing_alcohol)
unique(dat$reason_stopped_alcohol)


dat$alcohol_status <- factor(dat$alcohol_status, ordered = FALSE)
dat$alcohol_status <- relevel(dat$alcohol_status, ref = "Never")

dat$alcohol_freq <- factor(dat$alcohol_freq, levels = c("Never",
                                                        "Special occasions only",
                                                        "One to three times a month",
                                                        "Once or twice a week",
                                                        "Three or four times a week",
                                                        "Daily or almost daily"), ordered = FALSE)
dat$alcohol_freq <- relevel(dat$alcohol_freq, ref = "Never")

dat$alcohol_former <- factor(dat$alcohol_former, ordered = FALSE)
dat$alcohol_former <- relevel(dat$alcohol_former, ref = "No")

dat$red_wine_monthly <- as.numeric(dat$red_wine_monthly)
dat$red_wine_monthly[which(dat$red_wine_monthly == "-3")] <- NA         
dat$red_wine_monthly[which(dat$red_wine_monthly == "-1")] <- NA 

dat$white_wine_monthly <- as.numeric(dat$white_wine_monthly)
dat$white_wine_monthly[which(dat$white_wine_monthly == "-3")] <- NA         
dat$white_wine_monthly[which(dat$white_wine_monthly == "-1")] <- NA 

dat$beer_monthly <- as.numeric(dat$beer_monthly)
dat$beer_monthly[which(dat$beer_monthly == "-3")] <- NA         
dat$beer_monthly[which(dat$beer_monthly == "-1")] <- NA 

dat$spirits_monthly <- as.numeric(dat$spirits_monthly)
dat$spirits_monthly[which(dat$spirits_monthly == "-3")] <- NA         
dat$spirits_monthly[which(dat$spirits_monthly == "-1")] <- NA 

dat$fortified_wine_monthly <- as.numeric(dat$fortified_wine_monthly)
dat$fortified_wine_monthly[which(dat$fortified_wine_monthly == "-3")] <- NA         
dat$fortified_wine_monthly[which(dat$fortified_wine_monthly == "-1")] <- NA 

dat$other_alcohol_monthly <- as.numeric(dat$other_alcohol_monthly)
dat$other_alcohol_monthly[which(dat$other_alcohol_monthly == "-3")] <- NA         
dat$other_alcohol_monthly[which(dat$other_alcohol_monthly == "-1")] <- NA 

dat$red_wine_weekly <- as.numeric(dat$red_wine_weekly)
dat$red_wine_weekly[which(dat$red_wine_weekly == "-3")] <- NA         
dat$red_wine_weekly[which(dat$red_wine_weekly == "-1")] <- NA 

dat$white_wine_weekly <- as.numeric(dat$white_wine_weekly)
dat$white_wine_weekly[which(dat$white_wine_weekly == "-3")] <- NA         
dat$white_wine_weekly[which(dat$white_wine_weekly == "-1")] <- NA 

dat$beer_weekly <- as.numeric(dat$beer_weekly)
dat$beer_weekly[which(dat$beer_weekly == "-3")] <- NA         
dat$beer_weekly[which(dat$beer_weekly == "-1")] <- NA 

dat$spirits_weekly <- as.numeric(dat$spirits_weekly)
dat$spirits_weekly[which(dat$spirits_weekly == "-3")] <- NA         
dat$spirits_weekly[which(dat$spirits_weekly == "-1")] <- NA 

dat$fortified_wine_weekly <- as.numeric(dat$fortified_wine_weekly)
dat$fortified_wine_weekly[which(dat$fortified_wine_weekly == "-3")] <- NA         
dat$fortified_wine_weekly[which(dat$fortified_wine_weekly == "-1")] <- NA 

dat$other_alcohol_weekly <- as.numeric(dat$other_alcohol_weekly)
dat$other_alcohol_weekly[which(dat$other_alcohol_weekly == "-3")] <- NA         
dat$other_alcohol_weekly[which(dat$other_alcohol_weekly == "-1")] <- NA 

dat$alcohol_with_meals <- factor(dat$alcohol_with_meals, levels = c("No",
                                                                    "Yes",
                                                                    "It varies"), ordered = FALSE)
dat$alcohol_with_meals <- relevel(dat$alcohol_with_meals, ref = "No")

table(dat$alcohol_10yrs)
dat$alcohol_10yrs <- factor(dat$alcohol_10yrs, ordered = FALSE)
dat$alcohol_10yrs <- relevel(dat$alcohol_10yrs, ref = "Less nowadays")

table(dat$reason_reducing_alcohol)
dat$reason_reducing_alcohol <- factor(dat$reason_reducing_alcohol, ordered = FALSE)
dat$reason_reducing_alcohol <- relevel(dat$reason_reducing_alcohol, ref = "Other reason")

table(dat$reason_stopped_alcohol)
dat$reason_stopped_alcohol <- factor(dat$reason_stopped_alcohol, ordered = FALSE)
dat$reason_stopped_alcohol <- relevel(dat$reason_stopped_alcohol, ref = "Other reason")

```
<br />   

### Diet
```{r diet, results='hide'}

sort(unique(dat$cooked_veg))
sort(unique(dat$salad_or_raw_veg))
sort(unique(dat$fresh_fruit))
sort(unique(dat$dried_fruit))
sort(unique(dat$oily_fish))
sort(unique(dat$non_oily_fish))
sort(unique(dat$processed_meat))
sort(unique(dat$poultry))
sort(unique(dat$beef))
sort(unique(dat$lamb))
sort(unique(dat$pork))
sort(unique(dat$meat_age_last))
sort(unique(dat$cheese))
sort(unique(dat$milk_type))
sort(unique(dat$spread_type))
sort(unique(dat$spread_type_details))
sort(unique(dat$bread))
sort(unique(dat$bread_type))
sort(unique(dat$cereal))
sort(unique(dat$cereal_type))
sort(unique(dat$salt))
sort(unique(dat$tea))
sort(unique(dat$coffee_type))
sort(unique(dat$hot_drink_temp))
sort(unique(dat$water))
sort(unique(dat$diet_change_5yrs))
sort(unique(dat$diet_variation))


dat$cooked_veg <- as.numeric(dat$cooked_veg)
dat$cooked_veg[which(dat$cooked_veg == "-10")] <- 0.5        
dat$cooked_veg[which(dat$cooked_veg == "-3")] <- NA         
dat$cooked_veg[which(dat$cooked_veg == "-1")] <- NA 

dat$salad_or_raw_veg <- as.numeric(dat$salad_or_raw_veg)
dat$salad_or_raw_veg[which(dat$salad_or_raw_veg == "-10")] <- 0.5         
dat$salad_or_raw_veg[which(dat$salad_or_raw_veg == "-3")] <- NA         
dat$salad_or_raw_veg[which(dat$salad_or_raw_veg == "-1")] <- NA 

dat$fresh_fruit <- as.numeric(dat$fresh_fruit)
dat$fresh_fruit[which(dat$fresh_fruit == "-10")] <- 0.5         
dat$fresh_fruit[which(dat$fresh_fruit == "-3")] <- NA         
dat$fresh_fruit[which(dat$fresh_fruit == "-1")] <- NA 

dat$dried_fruit <- as.numeric(dat$dried_fruit)
dat$dried_fruit[which(dat$dried_fruit == "-10")] <- 0.5         
dat$dried_fruit[which(dat$dried_fruit == "-3")] <- NA         
dat$dried_fruit[which(dat$dried_fruit == "-1")] <- NA 

dat$oily_fish <- factor(dat$oily_fish, ordered = FALSE)
dat$oily_fish <- relevel(dat$oily_fish, ref = "Never")

dat$non_oily_fish <- factor(dat$non_oily_fish, ordered = FALSE)
dat$non_oily_fish <- relevel(dat$non_oily_fish, ref = "Never")

dat$processed_meat <- factor(dat$processed_meat, ordered = FALSE)
dat$processed_meat <- relevel(dat$processed_meat, ref = "Never")

dat$poultry <- factor(dat$poultry, ordered = FALSE)
dat$poultry <- relevel(dat$poultry, ref = "Never")

dat$beef <- factor(dat$beef, ordered = FALSE)
dat$beef <- relevel(dat$beef, ref = "Never")

dat$lamb <- factor(dat$lamb, ordered = FALSE)
dat$lamb <- relevel(dat$lamb, ref = "Never")

dat$pork <- factor(dat$pork, ordered = FALSE)
dat$pork <- relevel(dat$pork, ref = "Never")

dat$meat_age_last <- as.numeric(dat$meat_age_last)
dat$meat_age_last[which(dat$meat_age_last == "-3")] <- NA         
dat$meat_age_last[which(dat$meat_age_last == "-1")] <- NA         

dat$cheese <- factor(dat$cheese, ordered = FALSE)
dat$cheese <- relevel(dat$cheese, ref = "Never")

table(dat$milk_type)
dat$milk_type <- factor(dat$milk_type, ordered = FALSE)
dat$milk_type <- relevel(dat$milk_type, ref = "Semi-skimmed")

table(dat$spread_type)
dat$spread_type <- factor(dat$spread_type, ordered = FALSE)
dat$spread_type <- relevel(dat$spread_type, ref = "Other type of spread/margarine")

table(dat$spread_type_details)
dat$spread_type_details <- factor(dat$spread_type_details, ordered = FALSE)
dat$spread_type_details <- relevel(dat$spread_type_details, ref = "Polyunsaturated/sunflower oil based spread (eg: Flora)")

dat$bread <- as.numeric(dat$bread)
dat$bread[which(dat$bread == "-10")] <- 0.5        
dat$bread[which(dat$bread == "-3")] <- NA         
dat$bread[which(dat$bread == "-1")] <- NA  

table(dat$bread_type)
dat$bread_type <- factor(dat$bread_type, ordered = FALSE)
dat$bread_type <- relevel(dat$bread_type, ref = "Wholemeal or wholegrain")

dat$cereal <- as.numeric(dat$cereal)
dat$cereal[which(dat$cereal == "-10")] <- 0.5      
dat$cereal[which(dat$cereal == "-3")] <- NA         
dat$cereal[which(dat$cereal == "-1")] <- NA  

table(dat$cereal_type)
dat$cereal_type <- factor(dat$cereal_type, ordered = FALSE)
dat$cereal_type <- relevel(dat$cereal_type, ref = "Other (e.g. Cornflakes, Frosties)")

dat$salt <- factor(dat$salt, ordered = FALSE)
dat$salt <- relevel(dat$salt, ref = "Never/rarely")

dat$tea <- as.numeric(dat$tea)
dat$tea[which(dat$tea == "-10")] <- 0.5        
dat$tea[which(dat$tea == "-3")] <- NA         
dat$tea[which(dat$tea == "-1")] <- NA 

table(dat$coffee_type)
dat$coffee_type <- factor(dat$coffee_type, ordered = FALSE)
dat$coffee_type <- relevel(dat$coffee_type, ref = "Instant coffee")

table(dat$hot_drink_temp)
dat$hot_drink_temp <- factor(dat$hot_drink_temp, ordered = FALSE)
dat$hot_drink_temp <- relevel(dat$hot_drink_temp, ref = "Hot")

dat$water <- as.numeric(dat$water)
dat$water[which(dat$water == "-10")] <- 0.5        
dat$water[which(dat$water == "-3")] <- NA         
dat$water[which(dat$water == "-1")] <- NA 

dat$diet_change_5yrs <- factor(dat$diet_change_5yrs, ordered = FALSE)
dat$diet_change_5yrs <- relevel(dat$diet_change_5yrs, ref = "No")

dat$diet_variation <- factor(dat$diet_variation, ordered = FALSE)
dat$diet_variation <- relevel(dat$diet_variation, ref = "Never/rarely")

### dummy variables

## never eat

unique(dat$never_eat0.0)

prefix <- "never_eat0."
suffix <- seq(0,3)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]


# dummy var for Sugar or foods/drinks containing sugar
dat$never_eat_sugar <- ifelse(rowSums(dat[f] == "Sugar or foods/drinks containing sugar", na.rm = TRUE) > 0, 1, 
                              ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$never_eat_sugar)
dat$never_eat_sugar <- recode_factor(dat$never_eat_sugar,
                                     "0" = "No",
                                     "1" = "Yes")

# dummy var for Eggs or foods containing eggs
dat$never_eat_eggs <- ifelse(rowSums(dat[f] == "Eggs or foods containing eggs", na.rm = TRUE) > 0, 1, 
                              ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$never_eat_eggs)
dat$never_eat_eggs <- recode_factor(dat$never_eat_eggs,
                                    "0" = "No",
                                    "1" = "Yes")

# dummy var for Wheat products
dat$never_eat_wheat <- ifelse(rowSums(dat[f] == "Wheat products", na.rm = TRUE) > 0, 1, 
                              ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$never_eat_wheat)
dat$never_eat_wheat <- recode_factor(dat$never_eat_wheat,
                                     "0" = "No",
                                     "1" = "Yes")

# dummy var for Dairy products 
dat$never_eat_dairy <- ifelse(rowSums(dat[f] == "Dairy products", na.rm = TRUE) > 0, 1, 
                              ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$never_eat_dairy)
dat$never_eat_dairy <- recode_factor(dat$never_eat_dairy,
                                     "0" = "No",
                                     "1" = "Yes")


#remove columns used to make dummy vars
dat <- subset(dat, select = -c(never_eat0.0,
                               never_eat0.1,
                               never_eat0.2,
                               never_eat0.3))
            
```
<br />   

### Sun exposure
```{r sun, results='hide'}
sort(unique(dat$summer_outdoors_time))
sort(unique(dat$winter_outdoors_time))
sort(unique(dat$skin_color))
sort(unique(dat$skin_tan_ease))
sort(unique(dat$childhood_sunburn_number))
sort(unique(dat$hair_color))
sort(unique(dat$facial_aging))
sort(unique(dat$sun_protection_use))
sort(unique(dat$solarium_freq))


dat$summer_outdoors_time <- as.numeric(dat$summer_outdoors_time)
dat$summer_outdoors_time[which(dat$summer_outdoors_time == "-10")] <- 0.5         
dat$summer_outdoors_time[which(dat$summer_outdoors_time == "-3")] <- NA         
dat$summer_outdoors_time[which(dat$summer_outdoors_time == "-1")] <- NA  

dat$winter_outdoors_time <- as.numeric(dat$winter_outdoors_time)
dat$winter_outdoors_time[which(dat$winter_outdoors_time == "-10")] <- 0.5         
dat$winter_outdoors_time[which(dat$winter_outdoors_time == "-3")] <- NA         
dat$winter_outdoors_time[which(dat$winter_outdoors_time == "-1")] <- NA  

table(dat$skin_color)
dat$skin_color <- factor(dat$skin_color, ordered = FALSE)
dat$skin_color <- relevel(dat$skin_color, ref = "Fair")

table(dat$skin_tan_ease)
dat$skin_tan_ease <- factor(dat$skin_tan_ease, ordered = FALSE)
dat$skin_tan_ease <- relevel(dat$skin_tan_ease, ref = "Get moderately tanned")

dat$childhood_sunburn_number <- as.numeric(dat$childhood_sunburn_number)
dat$childhood_sunburn_number[which(dat$childhood_sunburn_number == "-3")] <- NA         
dat$childhood_sunburn_number[which(dat$childhood_sunburn_number == "-1")] <- NA  

table(dat$hair_color)
dat$hair_color <- factor(dat$hair_color, ordered = FALSE)
dat$hair_color <- relevel(dat$hair_color, ref = "Light brown")

table(dat$facial_aging)
dat$facial_aging <- factor(dat$facial_aging, ordered = FALSE)
dat$facial_aging <- relevel(dat$facial_aging, ref = "Younger than you are")

dat$sun_protection_use <- factor(dat$sun_protection_use, ordered = FALSE)
dat$sun_protection_use <- relevel(dat$sun_protection_use, ref = "Never/rarely")

dat$solarium_freq <- as.numeric(dat$solarium_freq)
dat$solarium_freq[which(dat$solarium_freq == "-10")] <- 0.5         
dat$solarium_freq[which(dat$solarium_freq == "-3")] <- NA         
dat$solarium_freq[which(dat$solarium_freq == "-1")] <- NA  
```
<br />   

### Sex history
```{r sex_hist, results='hide'}
sort(unique(dat$sex_age_first))
sort(unique(dat$number_sex_partners))
sort(unique(dat$same_sex_intercourse))
sort(unique(dat$number_same_sex_partners))

dat$sex_age_first <- as.numeric(dat$sex_age_first)
dat$sex_age_first[which(dat$sex_age_first == "-3")] <- NA         
dat$sex_age_first[which(dat$sex_age_first == "-2")] <- NA         
dat$sex_age_first[which(dat$sex_age_first == "-1")] <- NA 

dat$number_sex_partners <- as.numeric(dat$number_sex_partners)
dat$number_sex_partners[which(dat$number_sex_partners == "-3")] <- NA         
dat$number_sex_partners[which(dat$number_sex_partners == "-1")] <- NA 

dat$same_sex_intercourse <- factor(dat$same_sex_intercourse, ordered = FALSE)
dat$same_sex_intercourse <- relevel(dat$same_sex_intercourse, ref = "No")

dat$number_same_sex_partners <- as.numeric(dat$number_same_sex_partners)
dat$number_same_sex_partners[which(dat$number_same_sex_partners == "-3")] <- NA         
dat$number_same_sex_partners[which(dat$number_same_sex_partners == "-1")] <- NA 

# remove excluded variables

dat <- subset(dat, select = -c(sex_questions_answered))
```
<br />   

### Physical activity
```{r phys_activity, results='hide'}

sort(unique(dat$above_activity_recommendation))
sort(unique(dat$above_activity_recommendation_incl_walk))
sort(unique(dat$IPAQ_activity_group))
sort(unique(dat$MET_mins_moderate_activty))
sort(unique(dat$MET_mins_vigorous_activty))
sort(unique(dat$MET_mins_walking))
sort(unique(dat$days_activity_sum))
sort(unique(dat$mins_activity_sum))
sort(unique(dat$fast_driving))
sort(unique(dat$heavy_DIY_duration))
sort(unique(dat$light_DIY_duration))
sort(unique(dat$moderate_activity_duration))
sort(unique(dat$other_exercise_duration))
sort(unique(dat$strenuous_sports_duration))
sort(unique(dat$vigorous_activity_duration))
sort(unique(dat$walks_duration))
sort(unique(dat$pleasure_walks_duration))
sort(unique(dat$heavy_DIY_freq_4wks))
sort(unique(dat$light_DIY_freq_4wks))
sort(unique(dat$other_exercise_freq_4wks))
sort(unique(dat$stair_climbing_freq_4wks))
sort(unique(dat$strenuous_sports_freq_4wks))
sort(unique(dat$pleasure_walks_freq_4wks))
sort(unique(dat$moderate_activity_over_10mins_days))
sort(unique(dat$vigorous_activity_over_10mins_days))
sort(unique(dat$walked_over_10mins_days))
sort(unique(dat$driving_time))
sort(unique(dat$computer_time))
sort(unique(dat$TV_time))
sort(unique(dat$usual_walking_pace))


dat$above_activity_recommendation <- factor(dat$above_activity_recommendation, ordered = FALSE)
dat$above_activity_recommendation <- relevel(dat$above_activity_recommendation, ref = "No")

dat$above_activity_recommendation_incl_walk <- factor(dat$above_activity_recommendation_incl_walk, ordered = FALSE)
dat$above_activity_recommendation_incl_walk <- relevel(dat$above_activity_recommendation_incl_walk, ref = "No")

dat$IPAQ_activity_group <- factor(dat$IPAQ_activity_group, ordered = FALSE)
dat$IPAQ_activity_group <- relevel(dat$IPAQ_activity_group, ref = "low")

dat$MET_mins_moderate_activty <- as.numeric(dat$MET_mins_moderate_activty)

dat$MET_mins_vigorous_activty <- as.numeric(dat$MET_mins_vigorous_activty)

dat$MET_mins_walking <- as.numeric(dat$MET_mins_walking)

dat$days_activity_sum <- as.numeric(dat$days_activity_sum)

dat$mins_activity_sum <- as.numeric(dat$mins_activity_sum)

dat$fast_driving <- factor(dat$fast_driving, 
                           ordered = FALSE)
dat$fast_driving <- relevel(dat$fast_driving, 
                            ref = "Never/rarely")

dat$heavy_DIY_duration <- factor(dat$heavy_DIY_duration, 
                                 ordered = FALSE)
dat$heavy_DIY_duration <- relevel(dat$heavy_DIY_duration, 
                                  ref = "Less than 15 minutes")

dat$light_DIY_duration <- factor(dat$light_DIY_duration, 
                                 ordered = FALSE)
dat$light_DIY_duration <- relevel(dat$light_DIY_duration, 
                                  ref = "Less than 15 minutes")

dat$moderate_activity_duration <- as.numeric(dat$moderate_activity_duration)
dat$moderate_activity_duration[which(dat$moderate_activity_duration == "-3")] <- NA         
dat$moderate_activity_duration[which(dat$moderate_activity_duration == "-1")] <- NA 

dat$other_exercise_duration <- factor(dat$other_exercise_duration, ordered = FALSE)
dat$other_exercise_duration <- relevel(dat$other_exercise_duration, ref = "Less than 15 minutes")

dat$strenuous_sports_duration <- factor(dat$strenuous_sports_duration, ordered = FALSE)
dat$strenuous_sports_duration <- relevel(dat$strenuous_sports_duration, ref = "Less than 15 minutes")

dat$vigorous_activity_duration <- as.numeric(dat$vigorous_activity_duration)
dat$vigorous_activity_duration[which(dat$vigorous_activity_duration == "-3")] <- NA         
dat$vigorous_activity_duration[which(dat$vigorous_activity_duration == "-1")] <- NA 

dat$walks_duration <- as.numeric(dat$walks_duration)
dat$walks_duration[which(dat$walks_duration == "-3")] <- NA         
dat$walks_duration[which(dat$walks_duration == "-1")] <- NA 

dat$pleasure_walks_duration <- factor(dat$pleasure_walks_duration, ordered = FALSE)
dat$pleasure_walks_duration <- relevel(dat$pleasure_walks_duration, ref = "Less than 15 minutes")

dat$heavy_DIY_freq_4wks <- factor(dat$heavy_DIY_freq_4wks, ordered = FALSE)
dat$heavy_DIY_freq_4wks <- relevel(dat$heavy_DIY_freq_4wks, ref = "Once in the last 4 weeks")

dat$light_DIY_freq_4wks <- factor(dat$light_DIY_freq_4wks, ordered = FALSE)
dat$light_DIY_freq_4wks <- relevel(dat$light_DIY_freq_4wks, ref = "Once in the last 4 weeks")

dat$other_exercise_freq_4wks <- factor(dat$other_exercise_freq_4wks, ordered = FALSE)
dat$other_exercise_freq_4wks <- relevel(dat$light_DIY_freq_4wks, ref = "Once in the last 4 weeks")

dat$stair_climbing_freq_4wks <- factor(dat$stair_climbing_freq_4wks, ordered = FALSE)
dat$stair_climbing_freq_4wks <- relevel(dat$stair_climbing_freq_4wks, ref = "1-5 times a day")

dat$strenuous_sports_freq_4wks <- factor(dat$strenuous_sports_freq_4wks, ordered = FALSE)
dat$strenuous_sports_freq_4wks <- relevel(dat$strenuous_sports_freq_4wks, ref = "Once in the last 4 weeks")

dat$pleasure_walks_freq_4wks <- factor(dat$pleasure_walks_freq_4wks, ordered = FALSE)
dat$pleasure_walks_freq_4wks <- relevel(dat$pleasure_walks_freq_4wks, ref = "Once in the last 4 weeks")

dat$moderate_activity_over_10mins_days <- as.numeric(dat$moderate_activity_over_10mins_days)
dat$moderate_activity_over_10mins_days[which(dat$moderate_activity_over_10mins_days == "-3")] <- NA         
dat$moderate_activity_over_10mins_days[which(dat$moderate_activity_over_10mins_days == "-1")] <- NA 

dat$vigorous_activity_over_10mins_days <- as.numeric(dat$vigorous_activity_over_10mins_days)
dat$vigorous_activity_over_10mins_days[which(dat$vigorous_activity_over_10mins_days == "-3")] <- NA         
dat$vigorous_activity_over_10mins_days[which(dat$vigorous_activity_over_10mins_days == "-1")] <- NA 

dat$walked_over_10mins_days <- as.numeric(dat$walked_over_10mins_days)
dat$walked_over_10mins_days[which(dat$walked_over_10mins_days == "-3")] <- NA         
dat$walked_over_10mins_days[which(dat$walked_over_10mins_days == "-1")] <- NA 
#re-code "can't walk" as 0 mins
dat$walked_over_10mins_days[which(dat$walked_over_10mins_days == "-2")] <- 0 

dat$driving_time <- as.numeric(dat$driving_time)
dat$driving_time[which(dat$driving_time == "-10")] <- 0.5         
dat$driving_time[which(dat$driving_time == "-3")] <- NA         
dat$driving_time[which(dat$driving_time == "-1")] <- NA 

dat$computer_time <- as.numeric(dat$computer_time)
dat$computer_time[which(dat$computer_time == "-10")] <- 0.5         
dat$computer_time[which(dat$computer_time == "-3")] <- NA         
dat$computer_time[which(dat$computer_time == "-1")] <- NA 

dat$TV_time <- as.numeric(dat$TV_time)
dat$TV_time[which(dat$TV_time == "-10")] <- 0.5         
dat$TV_time[which(dat$TV_time == "-3")] <- NA         
dat$TV_time[which(dat$TV_time == "-1")] <- NA 

dat$usual_walking_pace <- factor(dat$usual_walking_pace, ordered = FALSE)
dat$usual_walking_pace <- relevel(dat$usual_walking_pace, ref = "Steady average pace") #this is the most common response


### dummy variables

## physical activity type

unique(dat$physical_activity_type.0.0)

prefix <- "physical_activity_type.0."
suffix <- seq(0,4)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]


# dummy var for Light DIY (eg: pruning, watering the lawn)
dat$light_DIY_4wks <- ifelse(rowSums(dat[f] == "Light DIY (eg: pruning, watering the lawn)", na.rm = TRUE) > 0, 1, 
                             ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$light_DIY_4wks)
dat$light_DIY_4wks <- recode_factor(dat$light_DIY_4wks,
                                    "0" = "No",
                                    "1" = "Yes")

# dummy var for Walking for pleasure (not as a means of transport) 
dat$pleasure_walks_4wks <- ifelse(rowSums(dat[f] == "Walking for pleasure (not as a means of transport)", na.rm = TRUE) > 0, 1, 
                                  ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$pleasure_walks_4wks)
dat$pleasure_walks_4wks <- recode_factor(dat$pleasure_walks_4wks,
                                         "0" = "No",
                                         "1" = "Yes")

# dummy var for Other exercises (eg: swimming, cycling, keep fit, bowling)
dat$other_exercise_4wks <- ifelse(rowSums(dat[f] == "Other exercises (eg: swimming, cycling, keep fit, bowling)", na.rm = TRUE) > 0, 1, 
                                  ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$other_exercise_4wks)
dat$other_exercise_4wks <- recode_factor(dat$other_exercise_4wks,
                                         "0" = "No",
                                         "1" = "Yes")

# dummy var for Heavy DIY (eg: weeding, lawn mowing, carpentry, digging)
dat$heavy_DIY_4wks <- ifelse(rowSums(dat[f] == "Heavy DIY (eg: weeding, lawn mowing, carpentry, digging)", na.rm = TRUE) > 0, 1, 
                             ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$heavy_DIY_4wks)
dat$heavy_DIY_4wks <- recode_factor(dat$heavy_DIY_4wks,
                                    "0" = "No",
                                    "1" = "Yes")

# dummy var for Strenuous sports 
dat$strenuous_sports_4wks <- ifelse(rowSums(dat[f] == "Strenuous sports", na.rm = TRUE) > 0, 1, 
                                    ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$strenuous_sports_4wks)
dat$strenuous_sports_4wks <- recode_factor(dat$strenuous_sports_4wks,
                                           "0" = "No",
                                           "1" = "Yes")

## transport type

unique(dat$transport_type.0.0)

prefix <- "transport_type.0."
suffix <- seq(0,4)
f <- names(dat)[grep(paste0(paste0(prefix, suffix), collapse = '|'), names(dat))]


# dummy var for Car/motor vehicle
dat$car_transport_4wks <- ifelse(rowSums(dat[f] == "Car/motor vehicle", na.rm = TRUE) > 0, 1, 
                                 ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$car_transport_4wks)
dat$car_transport_4wks <- recode_factor(dat$car_transport_4wks,
                                        "0" = "No",
                                        "1" = "Yes")

# dummy var for Walk
dat$walk_transport_4wks <- ifelse(rowSums(dat[f] == "Walk", na.rm = TRUE) > 0, 1, 
                                  ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$walk_transport_4wks)
dat$walk_transport_4wks <- recode_factor(dat$walk_transport_4wks,
                                         "0" = "No",
                                         "1" = "Yes")

# dummy var for Public transport
dat$public_transport_4wks <- ifelse(rowSums(dat[f] == "Public transport", na.rm = TRUE) > 0, 1, 
                                    ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$public_transport_4wks)
dat$public_transport_4wks <- recode_factor(dat$public_transport_4wks,
                                           "0" = "No",
                                           "1" = "Yes")

# dummy var for Cycle
dat$cycle_transport_4wks <- ifelse(rowSums(dat[f] == "Cycle", na.rm = TRUE) > 0, 1, 
                                   ifelse(rowSums(is.na(dat[f])) < length(f), 0, NA))
table(dat$cycle_transport_4wks)
dat$cycle_transport_4wks <- recode_factor(dat$cycle_transport_4wks,
                                          "0" = "No",
                                          "1" = "Yes")

# remove columns used to make dummy vars
dat <- subset(
  dat,
  select = -c(
    physical_activity_type.0.0,
    physical_activity_type.0.1,
    physical_activity_type.0.2,
    physical_activity_type.0.3,
    physical_activity_type.0.4,
    transport_type.0.0,
    transport_type.0.1,
    transport_type.0.2,
    transport_type.0.3
  )
)

```

### Vision
```{r vision, results='hide'}
sort(unique(dat$visual_acuity_left))
sort(unique(dat$visual_acuity_right))

dat$visual_acuity_left <- as.numeric(dat$visual_acuity_left)
dat$visual_acuity_right <- as.numeric(dat$visual_acuity_right)

```

### Hearing
```{r hearing, results='hide'}
sort(unique(dat$speech_reception_threshold_left))
sort(unique(dat$speech_reception_threshold_right))

dat$speech_reception_threshold_left <- as.numeric(dat$speech_reception_threshold_left)
dat$speech_reception_threshold_right <- as.numeric(dat$speech_reception_threshold_right)

```

### Blood pressure
```{r blood_pressure, results='hide'}

sort(unique(dat$diastolic_bp1))
sort(unique(dat$systolic_bp1))
sort(unique(dat$pulse_rate1))

dat$diastolic_bp1 <- as.numeric(dat$diastolic_bp1)
dat$diastolic_bp2 <- as.numeric(dat$diastolic_bp2)

dat$systolic_bp1 <- as.numeric(dat$systolic_bp1)
dat$systolic_bp2 <- as.numeric(dat$systolic_bp2)

dat$pulse_rate1 <- as.numeric(dat$pulse_rate1)
dat$pulse_rate2 <- as.numeric(dat$pulse_rate2)

# remove excluded variables
dat <- 
  subset(
    dat,
    select = -c(
      diastolic_bp_manual,
      systolic_bp_manual,
      pulse_rate_manual
    )
  )
```
<br />   

### Arterial stiffness
```{r art_stiff, results='hide'}

sort(unique(dat$pulse_wave_notch_position))
sort(unique(dat$pulse_wave_peak_position))
sort(unique(dat$pulse_wave_shoulder_position))
sort(unique(dat$pulse_wave_arterial_stiffness_index))
sort(unique(dat$pulse_wave_peak_to_peak_time))
sort(unique(dat$pulse_wave_reflection_index))

dat$pulse_wave_notch_position <- as.numeric(dat$pulse_wave_notch_position)
dat$pulse_wave_peak_position <- as.numeric(dat$pulse_wave_peak_position)
dat$pulse_wave_shoulder_position <- as.numeric(dat$pulse_wave_shoulder_position)
dat$pulse_wave_arterial_stiffness_index <- as.numeric(dat$pulse_wave_arterial_stiffness_index)
dat$pulse_wave_peak_to_peak_time <- as.numeric(dat$pulse_wave_peak_to_peak_time)
dat$pulse_wave_reflection_index <- as.numeric(dat$pulse_wave_reflection_index)
         
# remove excluded variables
dat <- subset(
  dat,
  select = -c(pulse_rate_a_stiff)
)

```
<br />   

### Anthropometrics
```{r anthro, results='hide'}

sort(unique(dat$waist_circumference))
sort(unique(dat$weight))
sort(unique(dat$BMI))
sort(unique(dat$hip_circumference))
sort(unique(dat$standing_height))
sort(unique(dat$seated_height))
sort(unique(dat$sitting_height))
sort(unique(dat$seating_box_height))
sort(unique(dat$hand_grip_strenght_left))
sort(unique(dat$hand_grip_strenght_right))
sort(unique(dat$leg_fat_free_mass_right))
sort(unique(dat$leg_predicted_mass_left))
sort(unique(dat$leg_predicted_mass_right))
sort(unique(dat$arm_fat_percentage_left))
sort(unique(dat$arm_fat_percentage_right))
sort(unique(dat$arm_fat_mass_left))
sort(unique(dat$arm_fat_mass_right))
sort(unique(dat$arm_fat_free_mass_right))
sort(unique(dat$arm_fat_free_mass_left))
sort(unique(dat$arm_predicted_mass_left))
sort(unique(dat$arm_predicted_mass_right))
sort(unique(dat$trunk_fat_percentage))
sort(unique(dat$trunk_fat_mass))
sort(unique(dat$trunk_fat_free_mass))
sort(unique(dat$trunk_predicted_mass))
sort(unique(dat$body_fat_percent))
sort(unique(dat$whole_body_fat_mass))
sort(unique(dat$whole_body_fat_free_mass))
sort(unique(dat$whole_body_water_mass))
sort(unique(dat$leg_fat_percentage_left))
sort(unique(dat$leg_fat_percentage_right))
sort(unique(dat$leg_fat_mass_left))
sort(unique(dat$leg_fat_mass_right))
sort(unique(dat$leg_fat_free_mass_left))
sort(unique(dat$whole_body_impedance))
sort(unique(dat$arm_left_impedance))
sort(unique(dat$arm_right_impedance))
sort(unique(dat$leg_left_impedance))
sort(unique(dat$leg_right_impedance))

colnames(dat)[colnames(dat) == 'hand_grip_strenght_left'] <- 'hand_grip_strength_left'
colnames(dat)[colnames(dat) == 'hand_grip_strenght_right'] <- 'hand_grip_strength_right'

# get column numbers of IMD vars
anthro_first <- match("waist_circumference",names(dat)) # col #
anthro_last <- match("leg_right_impedance",names(dat)) # col #

str(dat[anthro_first:anthro_last])

# convert all to numeric
dat[anthro_first:anthro_last] <- lapply(dat[anthro_first:anthro_last], as.numeric)
str(dat[anthro_first:anthro_last])


# remove excluded variables
dat <- subset(
  dat,
  select = -c(
    weight_manual,
    weight_impedance,
    BMI_impedance,
    seating_box_height,
    whole_body_impedance_manual,
    arm_left_impedance_manual,
    arm_right_impedance_manual,
    leg_left_impedance_manual,
    leg_right_impedance_manual))
```
<br />   

### Lung function
```{r spiro, results='hide'}

sort(unique(dat$FVC_best))
sort(unique(dat$FVC_z_score))
sort(unique(dat$FEV1_best))
sort(unique(dat$FEV1_predicted))
sort(unique(dat$FEV1_predicted_percentage))
sort(unique(dat$FEV1_z_score))
sort(unique(dat$FEV1_FVC_ratio_z_score))


dat$FVC_best <- as.numeric(dat$FVC_best)
dat$FVC_z_score <- as.numeric(dat$FVC_z_score)
dat$FEV1_best <- as.numeric(dat$FEV1_best)
dat$FEV1_predicted <- as.numeric(dat$FEV1_predicted)
dat$FEV1_predicted_percentage <- as.numeric(dat$FEV1_predicted_percentage)
dat$FEV1_z_score <- as.numeric(dat$FEV1_z_score)
dat$FEV1_FVC_ratio_z_score <- as.numeric(dat$FEV1_FVC_ratio_z_score)

# remove excluded variables
dat <- subset(
  dat,
  select = -c(
    blow_acceptability_text.0.0,
    blow_acceptability_text.0.1,
    blow_acceptability_text.0.2,
    blow_acceptability.0.0,
    blow_acceptability.0.1,
    blow_acceptability.0.2,
    number_spirometry_measurements,
    spirometry_QC,
    blow_ordering.0.0,
    blow_ordering.0.1,
    blow_ordering.0.2,
    blow_result_ranking.0.0,
    blow_result_ranking.0.1,
    blow_result_ranking.0.2,
    blow_data_points.0.0,
    blow_data_points.0.1,
    blow_data_points.0.2,
    FVC.0.0,
    FVC.0.1,
    FVC.0.2,
    FEV1.0.0,
    FEV1.0.1,
    FEV1.0.2,
    peak_expiratory_flow.0.0,
    peak_expiratory_flow.0.1,
    peak_expiratory_flow.0.2
  )
)
```
<br />   

### Bone mineral density
```{r bmd, results='hide'}
sort(unique(dat$fractured_heel))
sort(unique(dat$bone_density_measure_foot))
sort(unique(dat$heel_sound_speed))
sort(unique(dat$ankle_spacing_width))
sort(unique(dat$heel_broadband_attenuation))
sort(unique(dat$heel_QUI))
sort(unique(dat$heel_bone_mineral_density))
sort(unique(dat$heel_bone_mineral_density_t_score))
sort(unique(dat$fractured_heel_left))
sort(unique(dat$fractured_heel_right))
sort(unique(dat$ankle_spacing_width_left))
sort(unique(dat$ankle_spacing_width_right))
sort(unique(dat$heel_sound_speed_left))
sort(unique(dat$heel_sound_speed_right))
sort(unique(dat$heel_broadband_attenuation_left))
sort(unique(dat$heel_broadband_attenuation_right))
sort(unique(dat$heel_QUI_left))
sort(unique(dat$heel_QUI_right))
sort(unique(dat$heel_bone_mineral_density_left))
sort(unique(dat$heel_bone_mineral_density_right))
sort(unique(dat$heel_bone_mineral_density_t_score_left))
sort(unique(dat$heel_bone_mineral_density_t_score_right))


dat$fractured_heel <- factor(dat$fractured_heel, ordered = FALSE)
dat$fractured_heel <- relevel(dat$fractured_heel, ref = "No")

table(dat$bone_density_measure_foot)
dat$bone_density_measure_foot <- factor(dat$bone_density_measure_foot, ordered = FALSE)
dat$bone_density_measure_foot <- relevel(dat$bone_density_measure_foot, ref = "left")

dat$heel_sound_speed <- as.numeric(dat$heel_sound_speed)
dat$ankle_spacing_width <- as.numeric(dat$ankle_spacing_width)
dat$heel_broadband_attenuation <- as.numeric(dat$heel_broadband_attenuation)
dat$heel_QUI <- as.numeric(dat$heel_QUI)
dat$heel_bone_mineral_density <- as.numeric(dat$heel_bone_mineral_density)
dat$heel_bone_mineral_density_t_score <- as.numeric(dat$heel_bone_mineral_density_t_score)

dat$fractured_heel_left[which(dat$fractured_heel_left == "unsure")] <- NA         
dat$fractured_heel_left <- factor(dat$fractured_heel_left, ordered = FALSE)
dat$fractured_heel_left <- relevel(dat$fractured_heel_left, ref = "no")

dat$fractured_heel_right[which(dat$fractured_heel_right == "unsure")] <- NA         
dat$fractured_heel_right <- factor(dat$fractured_heel_right, ordered = FALSE)
dat$fractured_heel_right <- relevel(dat$fractured_heel_right, ref = "no")

dat$ankle_spacing_width_left <- as.numeric(dat$ankle_spacing_width_left)
dat$ankle_spacing_width_right <- as.numeric(dat$ankle_spacing_width_right)
dat$heel_sound_speed_left <- as.numeric(dat$heel_sound_speed_left)
dat$heel_sound_speed_right <- as.numeric(dat$heel_sound_speed_right)
dat$heel_broadband_attenuation_left <- as.numeric(dat$heel_broadband_attenuation_left)
dat$heel_broadband_attenuation_right <- as.numeric(dat$heel_broadband_attenuation_right)
dat$heel_QUI_left <- as.numeric(dat$heel_QUI_left)
dat$heel_QUI_right <- as.numeric(dat$heel_QUI_right)
dat$heel_bone_mineral_density_left <- as.numeric(dat$heel_bone_mineral_density_left)
dat$heel_bone_mineral_density_right <- as.numeric(dat$heel_bone_mineral_density_right)
dat$heel_bone_mineral_density_t_score_left <- as.numeric(dat$heel_bone_mineral_density_t_score_left)
dat$heel_bone_mineral_density_t_score_right <- as.numeric(dat$heel_bone_mineral_density_t_score_right)


# remove excluded variables
dat <-
  subset(
    dat,
    select = -c(
      heel_sound_speed_manual,
      heel_broadband_attenuation_manual,
      heel_QUI_manual,
      heel_bone_mineral_density_manual,
      heel_bone_ultrasound_t_score_manual,
      heel_sound_speed_manual_left,
      heel_sound_speed_manual_right,
      heel_broadband_attenuation_manual_left,
      heel_broadband_attenuation_manual_right,
      heel_QUI_manual_left,
      heel_QUI_manual_right,
      heel_bone_mineral_density_manual_left,
      heel_bone_mineral_density_manual_right,
      heel_bone_mineral_density_t_score_manual_left,
      heel_bone_mineral_density_t_score_manual_right
    )
  )
```
<br />   

### Material deprivation
```{r imd, results='hide'}

# get column numbers of IMD vars
imd_first <- match("IMD_services_Scotland",names(dat)) # col #
imd_last <- match("townsend_deprivation_index",names(dat)) # col #

# convert all to numeric
dat[imd_first:imd_last] <- lapply(dat[imd_first:imd_last], as.numeric)
str(dat[imd_first:imd_last])

```
<br />   

### Blood biomarkers
```{r blood, results='hide'}

# get column numbers 
blood_first <- match("alanine_aminotransferase", names(dat)) # col #
blood_last <- match("vitamin_D", names(dat)) # col #

#check if numeric
str(dat[blood_first:blood_last])

```
<br />   

### Blood cell count
```{r blood_count, results='hide'}

# get column numbers
blood_count_first <- match("basophill_count", names(dat)) # col #
blood_count_last <- match("leukocyte_count", names(dat)) # col #

#check if numeric
str(dat[blood_count_first:blood_count_last])

```
<br />   

### Urine biomarkers
```{r urine, results='hide'}

# get column numbers
urine_first <- match("creatinine_urine", names(dat)) # col #
urine_last <- match("sodium_urine", names(dat)) # col #

#check if numeric
str(dat[urine_first:urine_last])

dat$creatinine_urine <- as.numeric(dat$creatinine_urine)
```
<br />   

### Physical environment
```{r enviro, results='hide'}

# get column numbers
enviro_first <- match("inverse_distance_nearest_major_road", names(dat)) # col #
enviro_last <- match("distance_to_coast", names(dat)) # col #

#check if numeric
str(dat[enviro_first:enviro_last])

# convert all to numeric
dat[enviro_first:enviro_last] <- lapply(dat[enviro_first:enviro_last], as.numeric)
str(dat[enviro_first:enviro_last])


# recode factor
dat$close_to_major_road <- factor(dat$close_to_major_road, ordered = FALSE)
dat$close_to_major_road <- relevel(dat$close_to_major_road, ref = "No")

table(dat$home_population_density)
sort(unique(dat$home_population_density))

dat$home_population_density <- factor(dat$home_population_density, ordered = FALSE)
dat$home_population_density <- relevel(dat$home_population_density, ref = "England/Wales - Urban - less sparse")

```
<br />   

### New variables 
```{r new, results='hide'}

# recoding new variables sent by UKB later after the first dataset arrived
sort(unique(dat$identify_matches_mean_time))
sort(unique(dat$maximum_digits_remembered))
sort(unique(dat$fluid_intelligence))
sort(unique(dat$prospective_memory))
sort(unique(dat$incorrect_matches_round1))
sort(unique(dat$incorrect_matches_round2))
sort(unique(dat$IMD_employment_Scotland))
sort(unique(dat$sound_average_16hr))
sort(unique(dat$sound_average_24hr))
sort(unique(dat$basal_metabolic_rate))
sort(unique(dat$coffee))
sort(unique(dat$resume_smoking_likelihood))
sort(unique(dat$difficulty_not_smoking_1day))
sort(unique(dat$stop_smoking_attempt))
sort(unique(dat$stop_smoking_desire))
sort(unique(dat$happiness))
sort(unique(dat$job_satisfaction))
sort(unique(dat$health_satisfaction))
sort(unique(dat$family_satisfaction))
sort(unique(dat$friends_satisfaction))
sort(unique(dat$financial_satisfaction))
sort(unique(dat$menopause_age))
sort(unique(dat$diabetes_insulin_1yr))
sort(unique(dat$MET_mins_sum))


dat$identify_matches_mean_time <- as.numeric(dat$identify_matches_mean_time)

dat$maximum_digits_remembered <- as.numeric(dat$maximum_digits_remembered)
dat$maximum_digits_remembered[which(dat$maximum_digits_remembered == "-1")] <- NA 

dat$fluid_intelligence <- as.numeric(dat$fluid_intelligence)

dat$prospective_memory <- factor(dat$prospective_memory, 
                                 ordered = FALSE)

dat$prospective_memory <- relevel(dat$prospective_memory, 
                                  ref = "Instruction not recalled, either skipped or incorrect")

dat$incorrect_matches_round1 <- as.numeric(dat$incorrect_matches_round1)
dat$incorrect_matches_round2 <- as.numeric(dat$incorrect_matches_round2)
dat$IMD_employment_Scotland <- as.numeric(dat$IMD_employment_Scotland)
dat$sound_average_16hr <- as.numeric(dat$sound_average_16hr)
dat$sound_average_24hr <- as.numeric(dat$sound_average_24hr)
dat$basal_metabolic_rate <- as.numeric(dat$basal_metabolic_rate)

dat$coffee <- as.numeric(dat$coffee)
dat$coffee[which(dat$coffee == "-10")] <- 0.5
dat$coffee[which(dat$coffee == "-3")] <- NA 
dat$coffee[which(dat$coffee == "-1")] <- NA 

dat$resume_smoking_likelihood <- factor(dat$resume_smoking_likelihood, 
                                        levels = c("No, definitely not",
                                                   "No, probably not",
                                                   "Yes, probably",
                                                   "Yes, definitely"), ordered = FALSE)

dat$resume_smoking_likelihood <- relevel(dat$resume_smoking_likelihood, 
                                         ref = "No, definitely not")

dat$difficulty_not_smoking_1day <- factor(dat$difficulty_not_smoking_1day, 
                                          ordered = FALSE)

dat$difficulty_not_smoking_1day <- relevel(dat$difficulty_not_smoking_1day, 
                                           ref = "Very easy")

dat$stop_smoking_attempt <- factor(dat$stop_smoking_attempt, 
                                   ordered = FALSE)

dat$stop_smoking_attempt <- relevel(dat$stop_smoking_attempt, 
                                    ref = "No")

dat$stop_smoking_desire <- factor(dat$stop_smoking_desire, 
                                  levels = c("No, definitely not",
                                             "No, probably not",
                                             "Yes, probably",
                                             "Yes, definitely"), ordered = FALSE)

dat$stop_smoking_desire <- relevel(dat$stop_smoking_desire, 
                                   ref = "No, definitely not")

dat$happiness <- factor(dat$happiness, 
                        levels = c("Extremely unhappy",
                                   "Very unhappy",
                                   "Moderately unhappy",
                                   "Moderately happy",
                                   "Very happy",
                                   "Extremely happy"), ordered = FALSE)

dat$happiness <- relevel(dat$happiness, 
                         ref = "Extremely unhappy")

dat$job_satisfaction <- factor(dat$job_satisfaction, 
                               levels = c("Extremely unhappy",
                                          "Very unhappy",
                                          "Moderately unhappy",
                                          "Moderately happy",
                                          "Very happy",
                                          "Extremely happy",
                                          "I am not employed"), ordered = FALSE)

dat$job_satisfaction <- relevel(dat$job_satisfaction, 
                                ref = "Extremely unhappy")

dat$health_satisfaction <- factor(dat$health_satisfaction, 
                                  levels = c("Extremely unhappy",
                                             "Very unhappy",
                                             "Moderately unhappy",
                                             "Moderately happy",
                                             "Very happy",
                                             "Extremely happy"), ordered = FALSE)

dat$health_satisfaction <- relevel(dat$health_satisfaction, 
                                   ref = "Extremely unhappy")

dat$family_satisfaction <- factor(dat$family_satisfaction, 
                                  levels = c("Extremely unhappy",
                                             "Very unhappy",
                                             "Moderately unhappy",
                                             "Moderately happy",
                                             "Very happy",
                                             "Extremely happy"), ordered = FALSE)

dat$family_satisfaction <- relevel(dat$family_satisfaction, 
                                   ref = "Extremely unhappy")

dat$friends_satisfaction <- factor(dat$friends_satisfaction, 
                                   levels = c("Extremely unhappy",
                                              "Very unhappy",
                                              "Moderately unhappy",
                                              "Moderately happy",
                                              "Very happy",
                                              "Extremely happy"), ordered = FALSE)

dat$friends_satisfaction <- relevel(dat$friends_satisfaction, 
                                    ref = "Extremely unhappy")

dat$financial_satisfaction <- factor(dat$financial_satisfaction, 
                                     levels = c("Extremely unhappy",
                                                "Very unhappy",
                                                "Moderately unhappy",
                                                "Moderately happy",
                                                "Very happy",
                                                "Extremely happy"), ordered = FALSE)

dat$financial_satisfaction <- relevel(dat$financial_satisfaction, 
                                      ref = "Extremely unhappy")

dat$menopause_age <- as.numeric(dat$menopause_age)
dat$menopause_age[which(dat$menopause_age == "-3")] <- NA 
dat$menopause_age[which(dat$menopause_age == "-1")] <- NA 

dat$diabetes_insulin_1yr <- factor(dat$diabetes_insulin_1yr, 
                                   ordered = FALSE)

dat$diabetes_insulin_1yr <- relevel(dat$diabetes_insulin_1yr, 
                                    ref = "No")

dat$MET_mins_sum <- as.numeric(dat$MET_mins_sum)
```
<br /> 

```{r save, results='hide', include=FALSE}

# save final dataset
saveRDS(dat, file = ".../UKB/Datasets/5. Recoded datasets/ukb_full_recoded_dataset_jun_22_2023.rds")
```


